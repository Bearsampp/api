\doxysection{class.\+win32service.\+php}
\label{class_8win32service_8php_source}\index{E:/Bearsampp-\/development/sandbox/core/classes/class.win32service.php@{E:/Bearsampp-\/development/sandbox/core/classes/class.win32service.php}}
\textbf{ Go to the documentation of this file.}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ <?php}
\DoxyCodeLine{00002\ \textcolor{comment}{/*}}
\DoxyCodeLine{00003\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00004\ \textcolor{comment}{\ *\ \ *\ Copyright\ (c)\ 2022-\/2025\ Bearsampp}}
\DoxyCodeLine{00005\ \textcolor{comment}{\ *\ \ *\ License:\ GNU\ General\ Public\ License\ version\ 3\ or\ later;\ see\ LICENSE.txt}}
\DoxyCodeLine{00006\ \textcolor{comment}{\ *\ \ *\ Website:\ https://bearsampp.com}}
\DoxyCodeLine{00007\ \textcolor{comment}{\ *\ \ *\ Github:\ https://github.com/Bearsampp}}
\DoxyCodeLine{00008\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00009\ \textcolor{comment}{\ */}}
\DoxyCodeLine{00010\ }
\DoxyCodeLine{00017\ \textcolor{keyword}{class\ }Win32Service}
\DoxyCodeLine{00018\ \{}
\DoxyCodeLine{00019\ \ \ \ \ \textcolor{comment}{//\ Win32Service\ Service\ Status\ Constants}}
\DoxyCodeLine{00020\ \ \ \ \ \textcolor{keyword}{const}\ WIN32\_SERVICE\_CONTINUE\_PENDING\ =\ \textcolor{charliteral}{'5'};}
\DoxyCodeLine{00021\ \ \ \ \ \textcolor{keyword}{const}\ WIN32\_SERVICE\_PAUSE\_PENDING\ =\ \textcolor{charliteral}{'6'};}
\DoxyCodeLine{00022\ \ \ \ \ \textcolor{keyword}{const}\ WIN32\_SERVICE\_PAUSED\ =\ \textcolor{charliteral}{'7'};}
\DoxyCodeLine{00023\ \ \ \ \ \textcolor{keyword}{const}\ WIN32\_SERVICE\_RUNNING\ =\ \textcolor{charliteral}{'4'};}
\DoxyCodeLine{00024\ \ \ \ \ \textcolor{keyword}{const}\ WIN32\_SERVICE\_START\_PENDING\ =\ \textcolor{charliteral}{'2'};}
\DoxyCodeLine{00025\ \ \ \ \ \textcolor{keyword}{const}\ WIN32\_SERVICE\_STOP\_PENDING\ =\ \textcolor{charliteral}{'3'};}
\DoxyCodeLine{00026\ \ \ \ \ \textcolor{keyword}{const}\ WIN32\_SERVICE\_STOPPED\ =\ \textcolor{charliteral}{'1'};}
\DoxyCodeLine{00027\ \ \ \ \ \textcolor{keyword}{const}\ WIN32\_SERVICE\_NA\ =\ \textcolor{charliteral}{'0'};}
\DoxyCodeLine{00028\ }
\DoxyCodeLine{00029\ \ \ \ \ \textcolor{comment}{//\ Win32\ Error\ Codes}}
\DoxyCodeLine{00030\ \ \ \ \ \textcolor{keyword}{const}\ WIN32\_ERROR\_ACCESS\_DENIED\ =\ \textcolor{charliteral}{'5'};}
\DoxyCodeLine{00031\ \ \ \ \ \textcolor{keyword}{const}\ WIN32\_ERROR\_CIRCULAR\_DEPENDENCY\ =\ \textcolor{stringliteral}{'423'};}
\DoxyCodeLine{00032\ \ \ \ \ \textcolor{keyword}{const}\ WIN32\_ERROR\_DATABASE\_DOES\_NOT\_EXIST\ =\ \textcolor{stringliteral}{'429'};}
\DoxyCodeLine{00033\ \ \ \ \ \textcolor{keyword}{const}\ WIN32\_ERROR\_DEPENDENT\_SERVICES\_RUNNING\ =\ \textcolor{stringliteral}{'41B'};}
\DoxyCodeLine{00034\ \ \ \ \ \textcolor{keyword}{const}\ WIN32\_ERROR\_DUPLICATE\_SERVICE\_NAME\ =\ \textcolor{stringliteral}{'436'};}
\DoxyCodeLine{00035\ \ \ \ \ \textcolor{keyword}{const}\ WIN32\_ERROR\_FAILED\_SERVICE\_CONTROLLER\_CONNECT\ =\ \textcolor{stringliteral}{'427'};}
\DoxyCodeLine{00036\ \ \ \ \ \textcolor{keyword}{const}\ WIN32\_ERROR\_INSUFFICIENT\_BUFFER\ =\ \textcolor{stringliteral}{'7A'};}
\DoxyCodeLine{00037\ \ \ \ \ \textcolor{keyword}{const}\ WIN32\_ERROR\_INVALID\_DATA\ =\ \textcolor{charliteral}{'D'};}
\DoxyCodeLine{00038\ \ \ \ \ \textcolor{keyword}{const}\ WIN32\_ERROR\_INVALID\_HANDLE\ =\ \textcolor{charliteral}{'6'};}
\DoxyCodeLine{00039\ \ \ \ \ \textcolor{keyword}{const}\ WIN32\_ERROR\_INVALID\_LEVEL\ =\ \textcolor{stringliteral}{'7C'};}
\DoxyCodeLine{00040\ \ \ \ \ \textcolor{keyword}{const}\ WIN32\_ERROR\_INVALID\_NAME\ =\ \textcolor{stringliteral}{'7B'};}
\DoxyCodeLine{00041\ \ \ \ \ \textcolor{keyword}{const}\ WIN32\_ERROR\_INVALID\_PARAMETER\ =\ \textcolor{stringliteral}{'57'};}
\DoxyCodeLine{00042\ \ \ \ \ \textcolor{keyword}{const}\ WIN32\_ERROR\_INVALID\_SERVICE\_ACCOUNT\ =\ \textcolor{stringliteral}{'421'};}
\DoxyCodeLine{00043\ \ \ \ \ \textcolor{keyword}{const}\ WIN32\_ERROR\_INVALID\_SERVICE\_CONTROL\ =\ \textcolor{stringliteral}{'41C'};}
\DoxyCodeLine{00044\ \ \ \ \ \textcolor{keyword}{const}\ WIN32\_ERROR\_PATH\_NOT\_FOUND\ =\ \textcolor{charliteral}{'3'};}
\DoxyCodeLine{00045\ \ \ \ \ \textcolor{keyword}{const}\ WIN32\_ERROR\_SERVICE\_ALREADY\_RUNNING\ =\ \textcolor{stringliteral}{'420'};}
\DoxyCodeLine{00046\ \ \ \ \ \textcolor{keyword}{const}\ WIN32\_ERROR\_SERVICE\_CANNOT\_ACCEPT\_CTRL\ =\ \textcolor{stringliteral}{'425'};}
\DoxyCodeLine{00047\ \ \ \ \ \textcolor{keyword}{const}\ WIN32\_ERROR\_SERVICE\_DATABASE\_LOCKED\ =\ \textcolor{stringliteral}{'41F'};}
\DoxyCodeLine{00048\ \ \ \ \ \textcolor{keyword}{const}\ WIN32\_ERROR\_SERVICE\_DEPENDENCY\_DELETED\ =\ \textcolor{stringliteral}{'433'};}
\DoxyCodeLine{00049\ \ \ \ \ \textcolor{keyword}{const}\ WIN32\_ERROR\_SERVICE\_DEPENDENCY\_FAIL\ =\ \textcolor{stringliteral}{'42C'};}
\DoxyCodeLine{00050\ \ \ \ \ \textcolor{keyword}{const}\ WIN32\_ERROR\_SERVICE\_DISABLED\ =\ \textcolor{stringliteral}{'422'};}
\DoxyCodeLine{00051\ \ \ \ \ \textcolor{keyword}{const}\ WIN32\_ERROR\_SERVICE\_DOES\_NOT\_EXIST\ =\ \textcolor{stringliteral}{'424'};}
\DoxyCodeLine{00052\ \ \ \ \ \textcolor{keyword}{const}\ WIN32\_ERROR\_SERVICE\_EXISTS\ =\ \textcolor{stringliteral}{'431'};}
\DoxyCodeLine{00053\ \ \ \ \ \textcolor{keyword}{const}\ WIN32\_ERROR\_SERVICE\_LOGON\_FAILED\ =\ \textcolor{stringliteral}{'42D'};}
\DoxyCodeLine{00054\ \ \ \ \ \textcolor{keyword}{const}\ WIN32\_ERROR\_SERVICE\_MARKED\_FOR\_DELETE\ =\ \textcolor{stringliteral}{'430'};}
\DoxyCodeLine{00055\ \ \ \ \ \textcolor{keyword}{const}\ WIN32\_ERROR\_SERVICE\_NO\_THREAD\ =\ \textcolor{stringliteral}{'41E'};}
\DoxyCodeLine{00056\ \ \ \ \ \textcolor{keyword}{const}\ WIN32\_ERROR\_SERVICE\_NOT\_ACTIVE\ =\ \textcolor{stringliteral}{'426'};}
\DoxyCodeLine{00057\ \ \ \ \ \textcolor{keyword}{const}\ WIN32\_ERROR\_SERVICE\_REQUEST\_TIMEOUT\ =\ \textcolor{stringliteral}{'41D'};}
\DoxyCodeLine{00058\ \ \ \ \ \textcolor{keyword}{const}\ WIN32\_ERROR\_SHUTDOWN\_IN\_PROGRESS\ =\ \textcolor{stringliteral}{'45B'};}
\DoxyCodeLine{00059\ \ \ \ \ \textcolor{keyword}{const}\ WIN32\_NO\_ERROR\ =\ \textcolor{charliteral}{'0'};}
\DoxyCodeLine{00060\ }
\DoxyCodeLine{00061\ \ \ \ \ \textcolor{keyword}{const}\ SERVER\_ERROR\_IGNORE\ =\ \textcolor{charliteral}{'0'};}
\DoxyCodeLine{00062\ \ \ \ \ \textcolor{keyword}{const}\ SERVER\_ERROR\_NORMAL\ =\ \textcolor{charliteral}{'1'};}
\DoxyCodeLine{00063\ }
\DoxyCodeLine{00064\ \ \ \ \ \textcolor{keyword}{const}\ SERVICE\_AUTO\_START\ =\ \textcolor{charliteral}{'2'};}
\DoxyCodeLine{00065\ \ \ \ \ \textcolor{keyword}{const}\ SERVICE\_DEMAND\_START\ =\ \textcolor{charliteral}{'3'};}
\DoxyCodeLine{00066\ \ \ \ \ \textcolor{keyword}{const}\ SERVICE\_DISABLED\ =\ \textcolor{charliteral}{'4'};}
\DoxyCodeLine{00067\ }
\DoxyCodeLine{00068\ \ \ \ \ \textcolor{keyword}{const}\ PENDING\_TIMEOUT\ =\ 20;}
\DoxyCodeLine{00069\ \ \ \ \ \textcolor{keyword}{const}\ SLEEP\_TIME\ =\ 500000;}
\DoxyCodeLine{00070\ }
\DoxyCodeLine{00071\ \ \ \ \ \textcolor{keyword}{const}\ VBS\_NAME\ =\ \textcolor{stringliteral}{'Name'};}
\DoxyCodeLine{00072\ \ \ \ \ \textcolor{keyword}{const}\ VBS\_DISPLAY\_NAME\ =\ \textcolor{stringliteral}{'DisplayName'};}
\DoxyCodeLine{00073\ \ \ \ \ \textcolor{keyword}{const}\ VBS\_DESCRIPTION\ =\ \textcolor{stringliteral}{'Description'};}
\DoxyCodeLine{00074\ \ \ \ \ \textcolor{keyword}{const}\ VBS\_PATH\_NAME\ =\ \textcolor{stringliteral}{'PathName'};}
\DoxyCodeLine{00075\ \ \ \ \ \textcolor{keyword}{const}\ VBS\_STATE\ =\ \textcolor{stringliteral}{'State'};}
\DoxyCodeLine{00076\ }
\DoxyCodeLine{00077\ \ \ \ \ \textcolor{keyword}{private}\ \$name;}
\DoxyCodeLine{00078\ \ \ \ \ \textcolor{keyword}{private}\ \$displayName;}
\DoxyCodeLine{00079\ \ \ \ \ \textcolor{keyword}{private}\ \$binPath;}
\DoxyCodeLine{00080\ \ \ \ \ \textcolor{keyword}{private}\ \$params;}
\DoxyCodeLine{00081\ \ \ \ \ \textcolor{keyword}{private}\ \$startType;}
\DoxyCodeLine{00082\ \ \ \ \ \textcolor{keyword}{private}\ \$errorControl;}
\DoxyCodeLine{00083\ \ \ \ \ \textcolor{keyword}{private}\ \$nssm;}
\DoxyCodeLine{00084\ }
\DoxyCodeLine{00085\ \ \ \ \ \textcolor{keyword}{private}\ \$latestStatus;}
\DoxyCodeLine{00086\ \ \ \ \ \textcolor{keyword}{private}\ \$latestError;}
\DoxyCodeLine{00087\ }
\DoxyCodeLine{00088\ \ \ \ \ \textcolor{comment}{//\ Track\ which\ functions\ have\ been\ logged\ to\ avoid\ duplicate\ log\ entries}}
\DoxyCodeLine{00089\ \ \ \ \ \textcolor{keyword}{private}\ \textcolor{keyword}{static}\ \$loggedFunctions\ =\ array();}
\DoxyCodeLine{00090\ }
\DoxyCodeLine{00096\ \ \ \ \ \textcolor{keyword}{public}\ \textcolor{keyword}{function}\ \_\_construct(\$name)}
\DoxyCodeLine{00097\ \ \ \ \ \{}
\DoxyCodeLine{00098\ \ \ \ \ \ \ \ \ Util::logInitClass(\ \$this\ );}
\DoxyCodeLine{00099\ \ \ \ \ \ \ \ \ \$this-\/>name\ =\ \$name;}
\DoxyCodeLine{00100\ \ \ \ \ \}}
\DoxyCodeLine{00101\ }
\DoxyCodeLine{00107\ \ \ \ \ \textcolor{keyword}{private}\ \textcolor{keyword}{function}\ writeLog(\$log):\ void}
\DoxyCodeLine{00108\ \ \ \ \ \{}
\DoxyCodeLine{00109\ \ \ \ \ \ \ \ \ global\ \$bearsamppRoot;}
\DoxyCodeLine{00110\ \ \ \ \ \ \ \ \ Util::logDebug(\ \$log,\ \$bearsamppRoot-\/>getServicesLogFilePath()\ );}
\DoxyCodeLine{00111\ \ \ \ \ \}}
\DoxyCodeLine{00112\ }
\DoxyCodeLine{00118\ \ \ \ \ \textcolor{keyword}{public}\ \textcolor{keyword}{static}\ \textcolor{keyword}{function}\ getVbsKeys():\ array}
\DoxyCodeLine{00119\ \ \ \ \ \{}
\DoxyCodeLine{00120\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ array(}
\DoxyCodeLine{00121\ \ \ \ \ \ \ \ \ \ \ \ \ self::VBS\_NAME,}
\DoxyCodeLine{00122\ \ \ \ \ \ \ \ \ \ \ \ \ self::VBS\_DISPLAY\_NAME,}
\DoxyCodeLine{00123\ \ \ \ \ \ \ \ \ \ \ \ \ self::VBS\_DESCRIPTION,}
\DoxyCodeLine{00124\ \ \ \ \ \ \ \ \ \ \ \ \ self::VBS\_PATH\_NAME,}
\DoxyCodeLine{00125\ \ \ \ \ \ \ \ \ \ \ \ \ self::VBS\_STATE}
\DoxyCodeLine{00126\ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{00127\ \ \ \ \ \}}
\DoxyCodeLine{00128\ }
\DoxyCodeLine{00138\ \ \ \ \ \textcolor{keyword}{private}\ \textcolor{keyword}{function}\ callWin32Service(\$function,\ \$param,\ \$checkError\ =\ \textcolor{keyword}{false}):\ mixed}
\DoxyCodeLine{00139\ \ \ \ \ \{}
\DoxyCodeLine{00140\ \ \ \ \ \ \ \ \ \$result\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00141\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ function\_exists(\ \$function\ )\ )\ \{}
\DoxyCodeLine{00142\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!isset(self::\$loggedFunctions[\$function]))\ \{}
\DoxyCodeLine{00143\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{'Win32\ function:\ '}\ .\ \$function\ .\ \textcolor{stringliteral}{'\ exists'});}
\DoxyCodeLine{00144\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ self::\$loggedFunctions[\$function]\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00145\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00146\ }
\DoxyCodeLine{00147\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Special\ handling\ for\ win32\_query\_service\_status\ to\ prevent\ hanging}}
\DoxyCodeLine{00148\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\$function\ ===\ \textcolor{stringliteral}{'win32\_query\_service\_status'})\ \{}
\DoxyCodeLine{00149\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}Using\ enhanced\ handling\ for\ win32\_query\_service\_status"{}});}
\DoxyCodeLine{00150\ }
\DoxyCodeLine{00151\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Set\ a\ shorter\ timeout\ for\ this\ specific\ function}}
\DoxyCodeLine{00152\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \$originalTimeout\ =\ ini\_get(\textcolor{stringliteral}{'max\_execution\_time'});}
\DoxyCodeLine{00153\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ set\_time\_limit(5);\ \textcolor{comment}{//\ 5\ seconds\ timeout}}
\DoxyCodeLine{00154\ }
\DoxyCodeLine{00155\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{00156\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Ensure\ proper\ parameter\ handling\ for\ PHP\ 8.2.3\ compatibility}}
\DoxyCodeLine{00157\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \$result\ =\ call\_user\_func(\$function,\ \$param);}
\DoxyCodeLine{00158\ }
\DoxyCodeLine{00159\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Reset\ the\ timeout}}
\DoxyCodeLine{00160\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ set\_time\_limit(\$originalTimeout);}
\DoxyCodeLine{00161\ }
\DoxyCodeLine{00162\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\$checkError\ \&\&\ \$result\ !==\ \textcolor{keyword}{null})\ \{}
\DoxyCodeLine{00163\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Convert\ to\ int\ before\ using\ dechex\ for\ PHP\ 8.2.3\ compatibility}}
\DoxyCodeLine{00164\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \$resultInt\ =\ is\_numeric(\$result)\ ?\ (int)\$result\ :\ 0;}
\DoxyCodeLine{00165\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (dechex(\$resultInt)\ !=\ self::WIN32\_NO\_ERROR)\ \{}
\DoxyCodeLine{00166\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \$this-\/>latestError\ =\ dechex(\$resultInt);}
\DoxyCodeLine{00167\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00168\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00169\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\(\backslash\)Win32ServiceException\ \$e)\ \{}
\DoxyCodeLine{00170\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Reset\ the\ timeout}}
\DoxyCodeLine{00171\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ set\_time\_limit(\$originalTimeout);}
\DoxyCodeLine{00172\ }
\DoxyCodeLine{00173\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}Win32ServiceException\ caught:\ "{}}\ .\ \$e-\/>getMessage());}
\DoxyCodeLine{00174\ }
\DoxyCodeLine{00175\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Handle\ "{}service\ does\ not\ exist"{}\ exception}}
\DoxyCodeLine{00176\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (strpos(\$e-\/>getMessage(),\ \textcolor{stringliteral}{'service\ does\ not\ exist'})\ !==\ \textcolor{keyword}{false})\ \{}
\DoxyCodeLine{00177\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}Service\ does\ not\ exist\ exception\ handled\ for:\ "{}}\ .\ \$param);}
\DoxyCodeLine{00178\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Return\ the\ appropriate\ error\ code\ for\ "{}service\ does\ not\ exist"{}}}
\DoxyCodeLine{00179\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \$result\ =\ hexdec(self::WIN32\_ERROR\_SERVICE\_DOES\_NOT\_EXIST);}
\DoxyCodeLine{00180\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00181\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ For\ other\ exceptions,\ log\ and\ return\ false}}
\DoxyCodeLine{00182\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}Unhandled\ Win32ServiceException:\ "{}}\ .\ \$e-\/>getMessage());}
\DoxyCodeLine{00183\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \$result\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00184\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00185\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\(\backslash\)Exception\ \$e)\ \{}
\DoxyCodeLine{00186\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Reset\ the\ timeout}}
\DoxyCodeLine{00187\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ set\_time\_limit(\$originalTimeout);}
\DoxyCodeLine{00188\ }
\DoxyCodeLine{00189\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Catch\ any\ other\ exceptions\ to\ prevent\ application\ freeze}}
\DoxyCodeLine{00190\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}Exception\ caught\ in\ callWin32Service:\ "{}}\ .\ \$e-\/>getMessage());}
\DoxyCodeLine{00191\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \$result\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00192\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\(\backslash\)Throwable\ \$e)\ \{}
\DoxyCodeLine{00193\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Reset\ the\ timeout}}
\DoxyCodeLine{00194\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ set\_time\_limit(\$originalTimeout);}
\DoxyCodeLine{00195\ }
\DoxyCodeLine{00196\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Catch\ any\ other\ throwable\ (PHP\ 7+)\ to\ prevent\ application\ freeze}}
\DoxyCodeLine{00197\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}Throwable\ caught\ in\ callWin32Service:\ "{}}\ .\ \$e-\/>getMessage());}
\DoxyCodeLine{00198\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \$result\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00199\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00200\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00201\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Standard\ handling\ for\ other\ functions}}
\DoxyCodeLine{00202\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{00203\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Ensure\ proper\ parameter\ handling\ for\ PHP\ 8.2.3\ compatibility}}
\DoxyCodeLine{00204\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \$result\ =\ call\_user\_func(\$function,\ \$param);}
\DoxyCodeLine{00205\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\$checkError\ \&\&\ \$result\ !==\ \textcolor{keyword}{null})\ \{}
\DoxyCodeLine{00206\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Convert\ to\ int\ before\ using\ dechex\ for\ PHP\ 8.2.3\ compatibility}}
\DoxyCodeLine{00207\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \$resultInt\ =\ is\_numeric(\$result)\ ?\ (int)\$result\ :\ 0;}
\DoxyCodeLine{00208\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (dechex(\$resultInt)\ !=\ self::WIN32\_NO\_ERROR)\ \{}
\DoxyCodeLine{00209\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \$this-\/>latestError\ =\ dechex(\$resultInt);}
\DoxyCodeLine{00210\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00211\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00212\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\(\backslash\)Win32ServiceException\ \$e)\ \{}
\DoxyCodeLine{00213\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}Win32ServiceException\ caught:\ "{}}\ .\ \$e-\/>getMessage());}
\DoxyCodeLine{00214\ }
\DoxyCodeLine{00215\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Handle\ "{}service\ does\ not\ exist"{}\ exception}}
\DoxyCodeLine{00216\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (strpos(\$e-\/>getMessage(),\ \textcolor{stringliteral}{'service\ does\ not\ exist'})\ !==\ \textcolor{keyword}{false})\ \{}
\DoxyCodeLine{00217\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}Service\ does\ not\ exist\ exception\ handled\ for:\ "{}}\ .\ \$param);}
\DoxyCodeLine{00218\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Return\ the\ appropriate\ error\ code\ for\ "{}service\ does\ not\ exist"{}}}
\DoxyCodeLine{00219\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \$result\ =\ hexdec(self::WIN32\_ERROR\_SERVICE\_DOES\_NOT\_EXIST);}
\DoxyCodeLine{00220\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00221\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ For\ other\ exceptions,\ log\ and\ return\ false}}
\DoxyCodeLine{00222\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}Unhandled\ Win32ServiceException:\ "{}}\ .\ \$e-\/>getMessage());}
\DoxyCodeLine{00223\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \$result\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00224\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00225\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\(\backslash\)Exception\ \$e)\ \{}
\DoxyCodeLine{00226\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Catch\ any\ other\ exceptions\ to\ prevent\ application\ freeze}}
\DoxyCodeLine{00227\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}Exception\ caught\ in\ callWin32Service:\ "{}}\ .\ \$e-\/>getMessage());}
\DoxyCodeLine{00228\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \$result\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00229\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\(\backslash\)Throwable\ \$e)\ \{}
\DoxyCodeLine{00230\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Catch\ any\ other\ throwable\ (PHP\ 7+)\ to\ prevent\ application\ freeze}}
\DoxyCodeLine{00231\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}Throwable\ caught\ in\ callWin32Service:\ "{}}\ .\ \$e-\/>getMessage());}
\DoxyCodeLine{00232\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \$result\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00233\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00234\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00235\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00236\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!isset(self::\$loggedFunctions[\$function]))\ \{}
\DoxyCodeLine{00237\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{'Win32\ function:\ '}\ .\ \$function\ .\ \textcolor{stringliteral}{'\ missing'});}
\DoxyCodeLine{00238\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ self::\$loggedFunctions[\$function]\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00239\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00240\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00241\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \$result;}
\DoxyCodeLine{00242\ \ \ \ \ \}}
\DoxyCodeLine{00243\ }
\DoxyCodeLine{00251\ \ \ \ \ \textcolor{keyword}{public}\ \textcolor{keyword}{function}\ status(\$timeout\ =\ \textcolor{keyword}{true}):\ string}
\DoxyCodeLine{00252\ \ \ \ \ \{}
\DoxyCodeLine{00253\ \ \ \ \ \ \ \ \ usleep(\ self::SLEEP\_TIME\ );}
\DoxyCodeLine{00254\ }
\DoxyCodeLine{00255\ \ \ \ \ \ \ \ \ \$this-\/>latestStatus\ =\ self::WIN32\_SERVICE\_NA;}
\DoxyCodeLine{00256\ \ \ \ \ \ \ \ \ \$maxtime\ \ \ \ \ \ \ \ \ \ \ \ =\ time()\ +\ self::PENDING\_TIMEOUT;}
\DoxyCodeLine{00257\ }
\DoxyCodeLine{00258\ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}Querying\ status\ for\ service:\ "{}}\ .\ \$this-\/>getName()\ .\ \textcolor{stringliteral}{"{}\ (timeout:\ "{}}\ .\ (\$timeout\ ?\ \textcolor{stringliteral}{"{}enabled"{}}\ :\ \textcolor{stringliteral}{"{}disabled"{}})\ .\ \textcolor{stringliteral}{"{})"{}});}
\DoxyCodeLine{00259\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\$timeout)\ \{}
\DoxyCodeLine{00260\ \ \ \ \ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}Max\ timeout\ time\ set\ to:\ "{}}\ .\ date(\textcolor{stringliteral}{'Y-\/m-\/d\ H:i:s'},\ \$maxtime));}
\DoxyCodeLine{00261\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00262\ }
\DoxyCodeLine{00263\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Add\ a\ safety\ counter\ to\ prevent\ infinite\ loops}}
\DoxyCodeLine{00264\ \ \ \ \ \ \ \ \ \$loopCount\ =\ 0;}
\DoxyCodeLine{00265\ \ \ \ \ \ \ \ \ \$maxLoops\ =\ 5;\ \textcolor{comment}{//\ Maximum\ number\ of\ attempts}}
\DoxyCodeLine{00266\ \ \ \ \ \ \ \ \ \$startTime\ =\ microtime(\textcolor{keyword}{true});}
\DoxyCodeLine{00267\ }
\DoxyCodeLine{00268\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{00269\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (\ (\$this-\/>latestStatus\ ==\ self::WIN32\_SERVICE\_NA\ ||\ \$this-\/>isPending(\ \$this-\/>latestStatus\ ))\ \&\&\ \$loopCount\ <\ \$maxLoops\ )\ \{}
\DoxyCodeLine{00270\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \$loopCount++;}
\DoxyCodeLine{00271\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}Calling\ win32\_query\_service\_status\ for\ service:\ "{}}\ .\ \$this-\/>getName()\ .\ \textcolor{stringliteral}{"{}\ (attempt\ "{}}\ .\ \$loopCount\ .\ \textcolor{stringliteral}{"{}\ of\ "{}}\ .\ \$maxLoops\ .\ \textcolor{stringliteral}{"{})"{}});}
\DoxyCodeLine{00272\ }
\DoxyCodeLine{00273\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Add\ a\ timeout\ check\ before\ making\ the\ call}}
\DoxyCodeLine{00274\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (microtime(\textcolor{keyword}{true})\ -\/\ \$startTime\ >\ 10)\ \{\ \textcolor{comment}{//\ 10\ seconds\ overall\ timeout}}
\DoxyCodeLine{00275\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}Overall\ timeout\ reached\ before\ making\ service\ status\ call"{}});}
\DoxyCodeLine{00276\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00277\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00278\ }
\DoxyCodeLine{00279\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \$this-\/>latestStatus\ =\ \$this-\/>callWin32Service(\ \textcolor{stringliteral}{'win32\_query\_service\_status'},\ \$this-\/>getName()\ );}
\DoxyCodeLine{00280\ }
\DoxyCodeLine{00281\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ is\_array(\ \$this-\/>latestStatus\ )\ \&\&\ isset(\ \$this-\/>latestStatus[\textcolor{stringliteral}{'CurrentState'}]\ )\ )\ \{}
\DoxyCodeLine{00282\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Ensure\ proper\ type\ conversion\ for\ PHP\ 8.2.3\ compatibility}}
\DoxyCodeLine{00283\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \$stateInt\ =\ is\_numeric(\$this-\/>latestStatus[\textcolor{stringliteral}{'CurrentState'}])\ ?\ (int)\$this-\/>latestStatus[\textcolor{stringliteral}{'CurrentState'}]\ :\ 0;}
\DoxyCodeLine{00284\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \$this-\/>latestStatus\ =\ dechex(\ \$stateInt\ );}
\DoxyCodeLine{00285\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}Service\ status\ returned\ as\ array,\ CurrentState:\ "{}}\ .\ \$this-\/>latestStatus);}
\DoxyCodeLine{00286\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00287\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ elseif\ (\ \$this-\/>latestStatus\ !==\ \textcolor{keyword}{null}\ )\ \{}
\DoxyCodeLine{00288\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Ensure\ proper\ type\ conversion\ for\ PHP\ 8.2.3\ compatibility}}
\DoxyCodeLine{00289\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \$statusInt\ =\ is\_numeric(\$this-\/>latestStatus)\ ?\ (int)\$this-\/>latestStatus\ :\ 0;}
\DoxyCodeLine{00290\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \$statusHex\ =\ dechex(\ \$statusInt\ );}
\DoxyCodeLine{00291\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}Service\ status\ returned\ as\ value:\ "{}}\ .\ \$statusHex);}
\DoxyCodeLine{00292\ }
\DoxyCodeLine{00293\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \$statusHex\ ==\ self::WIN32\_ERROR\_SERVICE\_DOES\_NOT\_EXIST\ )\ \{}
\DoxyCodeLine{00294\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \$this-\/>latestStatus\ =\ \$statusHex;}
\DoxyCodeLine{00295\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}Service\ does\ not\ exist,\ breaking\ loop"{}});}
\DoxyCodeLine{00296\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};\ \textcolor{comment}{//\ Exit\ the\ loop\ immediately\ if\ service\ doesn't\ exist}}
\DoxyCodeLine{00297\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00298\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00299\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}Service\ status\ query\ returned\ null"{}});}
\DoxyCodeLine{00300\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ we\ get\ a\ null\ result,\ assume\ service\ does\ not\ exist\ to\ avoid\ hanging}}
\DoxyCodeLine{00301\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\$loopCount\ >=\ 2)\ \{\ \textcolor{comment}{//\ Only\ do\ this\ after\ at\ least\ one\ retry}}
\DoxyCodeLine{00302\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}Multiple\ null\ results,\ assuming\ service\ does\ not\ exist"{}});}
\DoxyCodeLine{00303\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \$this-\/>latestStatus\ =\ self::WIN32\_ERROR\_SERVICE\_DOES\_NOT\_EXIST;}
\DoxyCodeLine{00304\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00305\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00306\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00307\ }
\DoxyCodeLine{00308\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \$timeout\ \&\&\ \$maxtime\ <\ time()\ )\ \{}
\DoxyCodeLine{00309\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}Timeout\ reached\ while\ querying\ service\ status"{}});}
\DoxyCodeLine{00310\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00311\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00312\ }
\DoxyCodeLine{00313\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Only\ sleep\ if\ we're\ going\ to\ loop\ again}}
\DoxyCodeLine{00314\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\$loopCount\ <\ \$maxLoops\ \&\&\ (\$this-\/>latestStatus\ ==\ self::WIN32\_SERVICE\_NA\ ||\ \$this-\/>isPending(\$this-\/>latestStatus)))\ \{}
\DoxyCodeLine{00315\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}Sleeping\ before\ next\ status\ check\ attempt"{}});}
\DoxyCodeLine{00316\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ usleep(self::SLEEP\_TIME);}
\DoxyCodeLine{00317\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00318\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00319\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\(\backslash\)Exception\ \$e)\ \{}
\DoxyCodeLine{00320\ \ \ \ \ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}Exception\ in\ status\ method:\ "{}}\ .\ \$e-\/>getMessage());}
\DoxyCodeLine{00321\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ an\ exception\ occurs,\ assume\ service\ does\ not\ exist}}
\DoxyCodeLine{00322\ \ \ \ \ \ \ \ \ \ \ \ \ \$this-\/>latestStatus\ =\ self::WIN32\_ERROR\_SERVICE\_DOES\_NOT\_EXIST;}
\DoxyCodeLine{00323\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\(\backslash\)Throwable\ \$e)\ \{}
\DoxyCodeLine{00324\ \ \ \ \ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}Throwable\ in\ status\ method:\ "{}}\ .\ \$e-\/>getMessage());}
\DoxyCodeLine{00325\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ a\ throwable\ occurs,\ assume\ service\ does\ not\ exist}}
\DoxyCodeLine{00326\ \ \ \ \ \ \ \ \ \ \ \ \ \$this-\/>latestStatus\ =\ self::WIN32\_ERROR\_SERVICE\_DOES\_NOT\_EXIST;}
\DoxyCodeLine{00327\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00328\ }
\DoxyCodeLine{00329\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\$loopCount\ >=\ \$maxLoops)\ \{}
\DoxyCodeLine{00330\ \ \ \ \ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}Maximum\ query\ attempts\ reached\ for\ service:\ "{}}\ .\ \$this-\/>getName());}
\DoxyCodeLine{00331\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00332\ }
\DoxyCodeLine{00333\ \ \ \ \ \ \ \ \ \$elapsedTime\ =\ microtime(\textcolor{keyword}{true})\ -\/\ \$startTime;}
\DoxyCodeLine{00334\ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}Status\ check\ completed\ in\ "{}}\ .\ round(\$elapsedTime,\ 2)\ .\ \textcolor{stringliteral}{"{}\ seconds\ after\ "{}}\ .\ \$loopCount\ .\ \textcolor{stringliteral}{"{}\ attempts"{}});}
\DoxyCodeLine{00335\ }
\DoxyCodeLine{00336\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \$this-\/>latestStatus\ ==\ self::WIN32\_ERROR\_SERVICE\_DOES\_NOT\_EXIST\ )\ \{}
\DoxyCodeLine{00337\ \ \ \ \ \ \ \ \ \ \ \ \ \$this-\/>latestError\ \ =\ \$this-\/>latestStatus;}
\DoxyCodeLine{00338\ \ \ \ \ \ \ \ \ \ \ \ \ \$this-\/>latestStatus\ =\ self::WIN32\_SERVICE\_NA;}
\DoxyCodeLine{00339\ \ \ \ \ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}Service\ does\ not\ exist,\ setting\ status\ to\ NA"{}});}
\DoxyCodeLine{00340\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00341\ }
\DoxyCodeLine{00342\ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}Final\ status\ for\ service\ "{}}\ .\ \$this-\/>getName()\ .\ \textcolor{stringliteral}{"{}:\ "{}}\ .\ \$this-\/>latestStatus);}
\DoxyCodeLine{00343\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \$this-\/>latestStatus;}
\DoxyCodeLine{00344\ \ \ \ \ \}}
\DoxyCodeLine{00345\ }
\DoxyCodeLine{00351\ \ \ \ \ \textcolor{keyword}{public}\ \textcolor{keyword}{function}\ create():\ bool}
\DoxyCodeLine{00352\ \ \ \ \ \{}
\DoxyCodeLine{00353\ \ \ \ \ \ \ \ \ global\ \$bearsamppBins;}
\DoxyCodeLine{00354\ }
\DoxyCodeLine{00355\ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}Starting\ Win32Service::create\ for\ service:\ "{}}\ .\ \$this-\/>getName());}
\DoxyCodeLine{00356\ }
\DoxyCodeLine{00357\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \$this-\/>getName()\ ==\ BinPostgresql::SERVICE\_NAME\ )\ \{}
\DoxyCodeLine{00358\ \ \ \ \ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}PostgreSQL\ service\ detected\ -\/\ using\ specialized\ installation"{}});}
\DoxyCodeLine{00359\ \ \ \ \ \ \ \ \ \ \ \ \ \$bearsamppBins-\/>getPostgresql()-\/>rebuildConf();}
\DoxyCodeLine{00360\ \ \ \ \ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}PostgreSQL\ configuration\ rebuilt"{}});}
\DoxyCodeLine{00361\ }
\DoxyCodeLine{00362\ \ \ \ \ \ \ \ \ \ \ \ \ \$bearsamppBins-\/>getPostgresql()-\/>initData();}
\DoxyCodeLine{00363\ \ \ \ \ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}PostgreSQL\ data\ initialized"{}});}
\DoxyCodeLine{00364\ }
\DoxyCodeLine{00365\ \ \ \ \ \ \ \ \ \ \ \ \ \$result\ =\ Batch::installPostgresqlService();}
\DoxyCodeLine{00366\ \ \ \ \ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}PostgreSQL\ service\ installation\ "{}}\ .\ (\$result\ ?\ \textcolor{stringliteral}{"{}succeeded"{}}\ :\ \textcolor{stringliteral}{"{}failed"{}}));}
\DoxyCodeLine{00367\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \$result;}
\DoxyCodeLine{00368\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00369\ }
\DoxyCodeLine{00370\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \$this-\/>getNssm()\ instanceof\ Nssm\ )\ \{}
\DoxyCodeLine{00371\ \ \ \ \ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}Using\ NSSM\ for\ service\ installation"{}});}
\DoxyCodeLine{00372\ }
\DoxyCodeLine{00373\ \ \ \ \ \ \ \ \ \ \ \ \ \$nssmEnvPath\ =\ Util::getAppBinsRegKey(\ \textcolor{keyword}{false}\ );}
\DoxyCodeLine{00374\ \ \ \ \ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}NSSM\ environment\ path\ (bins):\ "{}}\ .\ \$nssmEnvPath);}
\DoxyCodeLine{00375\ }
\DoxyCodeLine{00376\ \ \ \ \ \ \ \ \ \ \ \ \ \$nssmEnvPath\ .=\ Util::getNssmEnvPaths();}
\DoxyCodeLine{00377\ \ \ \ \ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}NSSM\ environment\ path\ (with\ additional\ paths):\ "{}}\ .\ \$nssmEnvPath);}
\DoxyCodeLine{00378\ }
\DoxyCodeLine{00379\ \ \ \ \ \ \ \ \ \ \ \ \ \$nssmEnvPath\ .=\ \textcolor{stringliteral}{'\%SystemRoot\%/system32;'};}
\DoxyCodeLine{00380\ \ \ \ \ \ \ \ \ \ \ \ \ \$nssmEnvPath\ .=\ \textcolor{stringliteral}{'\%SystemRoot\%;'};}
\DoxyCodeLine{00381\ \ \ \ \ \ \ \ \ \ \ \ \ \$nssmEnvPath\ .=\ \textcolor{stringliteral}{'\%SystemRoot\%/system32/Wbem;'};}
\DoxyCodeLine{00382\ \ \ \ \ \ \ \ \ \ \ \ \ \$nssmEnvPath\ .=\ \textcolor{stringliteral}{'\%SystemRoot\%/system32/WindowsPowerShell/v1.0'};}
\DoxyCodeLine{00383\ \ \ \ \ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}NSSM\ final\ environment\ PATH:\ "{}}\ .\ \$nssmEnvPath);}
\DoxyCodeLine{00384\ }
\DoxyCodeLine{00385\ \ \ \ \ \ \ \ \ \ \ \ \ \$this-\/>getNssm()-\/>setEnvironmentExtra(\ \textcolor{stringliteral}{'PATH='}\ .\ \$nssmEnvPath\ );}
\DoxyCodeLine{00386\ \ \ \ \ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}NSSM\ service\ parameters:"{}});}
\DoxyCodeLine{00387\ \ \ \ \ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}-\/>\ Name:\ "{}}\ .\ \$this-\/>getNssm()-\/>getName());}
\DoxyCodeLine{00388\ \ \ \ \ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}-\/>\ DisplayName:\ "{}}\ .\ \$this-\/>getNssm()-\/>getDisplayName());}
\DoxyCodeLine{00389\ \ \ \ \ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}-\/>\ BinPath:\ "{}}\ .\ \$this-\/>getNssm()-\/>getBinPath());}
\DoxyCodeLine{00390\ \ \ \ \ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}-\/>\ Params:\ "{}}\ .\ \$this-\/>getNssm()-\/>getParams());}
\DoxyCodeLine{00391\ \ \ \ \ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}-\/>\ Start:\ "{}}\ .\ \$this-\/>getNssm()-\/>getStart());}
\DoxyCodeLine{00392\ \ \ \ \ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}-\/>\ Stdout:\ "{}}\ .\ \$this-\/>getNssm()-\/>getStdout());}
\DoxyCodeLine{00393\ \ \ \ \ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}-\/>\ Stderr:\ "{}}\ .\ \$this-\/>getNssm()-\/>getStderr());}
\DoxyCodeLine{00394\ }
\DoxyCodeLine{00395\ \ \ \ \ \ \ \ \ \ \ \ \ \$result\ =\ \$this-\/>getNssm()-\/>create();}
\DoxyCodeLine{00396\ \ \ \ \ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}NSSM\ service\ creation\ "{}}\ .\ (\$result\ ?\ \textcolor{stringliteral}{"{}succeeded"{}}\ :\ \textcolor{stringliteral}{"{}failed"{}}));}
\DoxyCodeLine{00397\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\$result)\ \{}
\DoxyCodeLine{00398\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}NSSM\ error:\ "{}}\ .\ \$this-\/>getNssm()-\/>getLatestError());}
\DoxyCodeLine{00399\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00400\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \$result;}
\DoxyCodeLine{00401\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00402\ }
\DoxyCodeLine{00403\ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}Using\ win32\_create\_service\ for\ service\ installation"{}});}
\DoxyCodeLine{00404\ \ \ \ \ \ \ \ \ \$serviceParams\ =\ array(}
\DoxyCodeLine{00405\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'service'}\ \ \ \ \ \ \ =>\ \$this-\/>getName(),}
\DoxyCodeLine{00406\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'display'}\ \ \ \ \ \ \ =>\ \$this-\/>getDisplayName(),}
\DoxyCodeLine{00407\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'description'}\ \ \ =>\ \$this-\/>getDisplayName(),}
\DoxyCodeLine{00408\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'path'}\ \ \ \ \ \ \ \ \ \ =>\ \$this-\/>getBinPath(),}
\DoxyCodeLine{00409\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'params'}\ \ \ \ \ \ \ \ =>\ \$this-\/>getParams(),}
\DoxyCodeLine{00410\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'start\_type'}\ \ \ \ =>\ \$this-\/>getStartType()\ !=\ \textcolor{keyword}{null}\ ?\ \$this-\/>getStartType()\ :\ self::SERVICE\_DEMAND\_START,}
\DoxyCodeLine{00411\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'error\_control'}\ =>\ \$this-\/>getErrorControl()\ !=\ \textcolor{keyword}{null}\ ?\ \$this-\/>getErrorControl()\ :\ self::SERVER\_ERROR\_NORMAL,}
\DoxyCodeLine{00412\ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{00413\ }
\DoxyCodeLine{00414\ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}win32\_create\_service\ parameters:"{}});}
\DoxyCodeLine{00415\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{foreach}\ (\$serviceParams\ as\ \$key\ =>\ \$value)\ \{}
\DoxyCodeLine{00416\ \ \ \ \ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}-\/>\ \$key:\ \$value"{}});}
\DoxyCodeLine{00417\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00418\ }
\DoxyCodeLine{00419\ \ \ \ \ \ \ \ \ \$result\ =\ \$this-\/>callWin32Service(\ \textcolor{stringliteral}{'win32\_create\_service'},\ \$serviceParams,\ \textcolor{keyword}{true}\ );}
\DoxyCodeLine{00420\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Ensure\ proper\ type\ conversion\ for\ PHP\ 8.2.3\ compatibility}}
\DoxyCodeLine{00421\ \ \ \ \ \ \ \ \ \$resultInt\ =\ is\_numeric(\$result)\ ?\ (int)\$result\ :\ 0;}
\DoxyCodeLine{00422\ \ \ \ \ \ \ \ \ \$create\ =\ \$result\ !==\ \textcolor{keyword}{null}\ ?\ dechex(\ \$resultInt\ )\ :\ \textcolor{charliteral}{'0'};}
\DoxyCodeLine{00423\ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}win32\_create\_service\ result\ code:\ "{}}\ .\ \$create);}
\DoxyCodeLine{00424\ }
\DoxyCodeLine{00425\ \ \ \ \ \ \ \ \ \$this-\/>writeLog(\ \textcolor{stringliteral}{'Create\ service:\ '}\ .\ \$create\ .\ \textcolor{stringliteral}{'\ (status:\ '}\ .\ \$this-\/>status()\ .\ \textcolor{charliteral}{')'}\ );}
\DoxyCodeLine{00426\ \ \ \ \ \ \ \ \ \$this-\/>writeLog(\ \textcolor{stringliteral}{'-\/>\ service:\ '}\ .\ \$this-\/>getName()\ );}
\DoxyCodeLine{00427\ \ \ \ \ \ \ \ \ \$this-\/>writeLog(\ \textcolor{stringliteral}{'-\/>\ display:\ '}\ .\ \$this-\/>getDisplayName()\ );}
\DoxyCodeLine{00428\ \ \ \ \ \ \ \ \ \$this-\/>writeLog(\ \textcolor{stringliteral}{'-\/>\ description:\ '}\ .\ \$this-\/>getDisplayName()\ );}
\DoxyCodeLine{00429\ \ \ \ \ \ \ \ \ \$this-\/>writeLog(\ \textcolor{stringliteral}{'-\/>\ path:\ '}\ .\ \$this-\/>getBinPath()\ );}
\DoxyCodeLine{00430\ \ \ \ \ \ \ \ \ \$this-\/>writeLog(\ \textcolor{stringliteral}{'-\/>\ params:\ '}\ .\ \$this-\/>getParams()\ );}
\DoxyCodeLine{00431\ \ \ \ \ \ \ \ \ \$this-\/>writeLog(\ \textcolor{stringliteral}{'-\/>\ start\_type:\ '}\ .\ (\$this-\/>getStartType()\ !=\ \textcolor{keyword}{null}\ ?\ \$this-\/>getStartType()\ :\ self::SERVICE\_DEMAND\_START)\ );}
\DoxyCodeLine{00432\ \ \ \ \ \ \ \ \ \$this-\/>writeLog(\ \textcolor{stringliteral}{'-\/>\ service:\ '}\ .\ (\$this-\/>getErrorControl()\ !=\ \textcolor{keyword}{null}\ ?\ \$this-\/>getErrorControl()\ :\ self::SERVER\_ERROR\_NORMAL)\ );}
\DoxyCodeLine{00433\ }
\DoxyCodeLine{00434\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \$create\ !=\ self::WIN32\_NO\_ERROR\ )\ \{}
\DoxyCodeLine{00435\ \ \ \ \ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}Service\ creation\ failed\ with\ error\ code:\ "{}}\ .\ \$create);}
\DoxyCodeLine{00436\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00437\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00438\ \ \ \ \ \ \ \ \ elseif\ (\ !\$this-\/>isInstalled()\ )\ \{}
\DoxyCodeLine{00439\ \ \ \ \ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}Service\ created\ but\ not\ found\ as\ installed"{}});}
\DoxyCodeLine{00440\ \ \ \ \ \ \ \ \ \ \ \ \ \$this-\/>latestError\ =\ self::WIN32\_NO\_ERROR;}
\DoxyCodeLine{00441\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00442\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00443\ }
\DoxyCodeLine{00444\ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}Service\ created\ successfully:\ "{}}\ .\ \$this-\/>getName());}
\DoxyCodeLine{00445\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00446\ \ \ \ \ \}}
\DoxyCodeLine{00447\ }
\DoxyCodeLine{00453\ \ \ \ \ \textcolor{keyword}{public}\ \textcolor{keyword}{function}\ \textcolor{keyword}{delete}():\ bool}
\DoxyCodeLine{00454\ \ \ \ \ \{}
\DoxyCodeLine{00455\ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}Starting\ Win32Service::delete\ for\ service:\ "{}}\ .\ \$this-\/>getName());}
\DoxyCodeLine{00456\ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}Checking\ if\ service\ is\ installed:\ "{}}\ .\ \$this-\/>getName());}
\DoxyCodeLine{00457\ }
\DoxyCodeLine{00458\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ !\$this-\/>isInstalled()\ )\ \{}
\DoxyCodeLine{00459\ \ \ \ \ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}Service\ is\ not\ installed,\ skipping\ deletion:\ "{}}\ .\ \$this-\/>getName());}
\DoxyCodeLine{00460\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00461\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00462\ }
\DoxyCodeLine{00463\ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}Stopping\ service\ before\ deletion:\ "{}}\ .\ \$this-\/>getName());}
\DoxyCodeLine{00464\ \ \ \ \ \ \ \ \ \$this-\/>stop();}
\DoxyCodeLine{00465\ }
\DoxyCodeLine{00466\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \$this-\/>getName()\ ==\ BinPostgresql::SERVICE\_NAME\ )\ \{}
\DoxyCodeLine{00467\ \ \ \ \ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}PostgreSQL\ service\ detected\ -\/\ using\ specialized\ uninstallation"{}});}
\DoxyCodeLine{00468\ \ \ \ \ \ \ \ \ \ \ \ \ \$result\ =\ Batch::uninstallPostgresqlService();}
\DoxyCodeLine{00469\ \ \ \ \ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}PostgreSQL\ service\ uninstallation\ "{}}\ .\ (\$result\ ?\ \textcolor{stringliteral}{"{}succeeded"{}}\ :\ \textcolor{stringliteral}{"{}failed"{}}));}
\DoxyCodeLine{00470\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \$result;}
\DoxyCodeLine{00471\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00472\ }
\DoxyCodeLine{00473\ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}Calling\ win32\_delete\_service\ for\ service:\ "{}}\ .\ \$this-\/>getName());}
\DoxyCodeLine{00474\ \ \ \ \ \ \ \ \ \$result\ =\ \$this-\/>callWin32Service(\ \textcolor{stringliteral}{'win32\_delete\_service'},\ \$this-\/>getName(),\ \textcolor{keyword}{true}\ );}
\DoxyCodeLine{00475\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Ensure\ proper\ type\ conversion\ for\ PHP\ 8.2.3\ compatibility}}
\DoxyCodeLine{00476\ \ \ \ \ \ \ \ \ \$resultInt\ =\ is\_numeric(\$result)\ ?\ (int)\$result\ :\ 0;}
\DoxyCodeLine{00477\ \ \ \ \ \ \ \ \ \$delete\ =\ \$result\ !==\ \textcolor{keyword}{null}\ ?\ dechex(\ \$resultInt\ )\ :\ \textcolor{charliteral}{'0'};}
\DoxyCodeLine{00478\ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}Delete\ service\ result\ code:\ "{}}\ .\ \$delete);}
\DoxyCodeLine{00479\ \ \ \ \ \ \ \ \ \$this-\/>writeLog(\ \textcolor{stringliteral}{'Delete\ service\ '}\ .\ \$this-\/>getName()\ .\ \textcolor{stringliteral}{':\ '}\ .\ \$delete\ .\ \textcolor{stringliteral}{'\ (status:\ '}\ .\ \$this-\/>status()\ .\ \textcolor{charliteral}{')'}\ );}
\DoxyCodeLine{00480\ }
\DoxyCodeLine{00481\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \$delete\ !=\ self::WIN32\_NO\_ERROR\ \&\&\ \$delete\ !=\ self::WIN32\_ERROR\_SERVICE\_DOES\_NOT\_EXIST\ )\ \{}
\DoxyCodeLine{00482\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00483\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00484\ \ \ \ \ \ \ \ \ elseif\ (\ \$this-\/>isInstalled()\ )\ \{}
\DoxyCodeLine{00485\ \ \ \ \ \ \ \ \ \ \ \ \ \$this-\/>latestError\ =\ self::WIN32\_NO\_ERROR;}
\DoxyCodeLine{00486\ }
\DoxyCodeLine{00487\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00488\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00489\ }
\DoxyCodeLine{00490\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00491\ \ \ \ \ \}}
\DoxyCodeLine{00492\ }
\DoxyCodeLine{00498\ \ \ \ \ \textcolor{keyword}{public}\ \textcolor{keyword}{function}\ reset():\ bool}
\DoxyCodeLine{00499\ \ \ \ \ \{}
\DoxyCodeLine{00500\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \$this-\/>\textcolor{keyword}{delete}()\ )\ \{}
\DoxyCodeLine{00501\ \ \ \ \ \ \ \ \ \ \ \ \ usleep(\ self::SLEEP\_TIME\ );}
\DoxyCodeLine{00502\ }
\DoxyCodeLine{00503\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \$this-\/>create();}
\DoxyCodeLine{00504\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00505\ }
\DoxyCodeLine{00506\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00507\ \ \ \ \ \}}
\DoxyCodeLine{00508\ }
\DoxyCodeLine{00514\ \ \ \ \ \textcolor{keyword}{public}\ \textcolor{keyword}{function}\ start():\ bool}
\DoxyCodeLine{00515\ \ \ \ \ \{}
\DoxyCodeLine{00516\ \ \ \ \ \ \ \ \ global\ \$bearsamppBins;}
\DoxyCodeLine{00517\ }
\DoxyCodeLine{00518\ \ \ \ \ \ \ \ \ Util::logInfo(\textcolor{stringliteral}{'Attempting\ to\ start\ service:\ '}\ .\ \$this-\/>getName());}
\DoxyCodeLine{00519\ }
\DoxyCodeLine{00520\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \$this-\/>getName()\ ==\ BinMysql::SERVICE\_NAME\ )\ \{}
\DoxyCodeLine{00521\ \ \ \ \ \ \ \ \ \ \ \ \ \$bearsamppBins-\/>getMysql()-\/>initData();}
\DoxyCodeLine{00522\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00523\ \ \ \ \ \ \ \ \ elseif\ (\ \$this-\/>getName()\ ==\ BinMailpit::SERVICE\_NAME\ )\ \{}
\DoxyCodeLine{00524\ \ \ \ \ \ \ \ \ \ \ \ \ \$bearsamppBins-\/>getMailpit()-\/>rebuildConf();}
\DoxyCodeLine{00525\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00526\ \ \ \ \ \ \ \ \ elseif\ (\ \$this-\/>getName()\ ==\ BinMemcached::SERVICE\_NAME\ )\ \{}
\DoxyCodeLine{00527\ \ \ \ \ \ \ \ \ \ \ \ \ \$bearsamppBins-\/>getMemcached()-\/>rebuildConf();}
\DoxyCodeLine{00528\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00529\ \ \ \ \ \ \ \ \ elseif\ (\ \$this-\/>getName()\ ==\ BinPostgresql::SERVICE\_NAME\ )\ \{}
\DoxyCodeLine{00530\ \ \ \ \ \ \ \ \ \ \ \ \ \$bearsamppBins-\/>getPostgresql()-\/>rebuildConf();}
\DoxyCodeLine{00531\ \ \ \ \ \ \ \ \ \ \ \ \ \$bearsamppBins-\/>getPostgresql()-\/>initData();}
\DoxyCodeLine{00532\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00533\ \ \ \ \ \ \ \ \ elseif\ (\ \$this-\/>getName()\ ==\ BinXlight::SERVICE\_NAME\ )\ \{}
\DoxyCodeLine{00534\ \ \ \ \ \ \ \ \ \ \ \ \ \$bearsamppBins-\/>getXlight()-\/>rebuildConf();}
\DoxyCodeLine{00535\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00536\ }
\DoxyCodeLine{00537\ }
\DoxyCodeLine{00538\ \ \ \ \ \ \ \ \ \$result\ =\ \$this-\/>callWin32Service(\ \textcolor{stringliteral}{'win32\_start\_service'},\ \$this-\/>getName(),\ \textcolor{keyword}{true}\ );}
\DoxyCodeLine{00539\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Ensure\ proper\ type\ conversion\ for\ PHP\ 8.2.3\ compatibility}}
\DoxyCodeLine{00540\ \ \ \ \ \ \ \ \ \$resultInt\ =\ is\_numeric(\$result)\ ?\ (int)\$result\ :\ 0;}
\DoxyCodeLine{00541\ \ \ \ \ \ \ \ \ \$start\ =\ \$result\ !==\ \textcolor{keyword}{null}\ ?\ dechex(\ \$resultInt\ )\ :\ \textcolor{charliteral}{'0'};}
\DoxyCodeLine{00542\ \ \ \ \ \ \ \ \ Util::logDebug(\ \textcolor{stringliteral}{'Start\ service\ '}\ .\ \$this-\/>getName()\ .\ \textcolor{stringliteral}{':\ '}\ .\ \$start\ .\ \textcolor{stringliteral}{'\ (status:\ '}\ .\ \$this-\/>status()\ .\ \textcolor{charliteral}{')'}\ );}
\DoxyCodeLine{00543\ }
\DoxyCodeLine{00544\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \$start\ !=\ self::WIN32\_NO\_ERROR\ \&\&\ \$start\ !=\ self::WIN32\_ERROR\_SERVICE\_ALREADY\_RUNNING\ )\ \{}
\DoxyCodeLine{00545\ }
\DoxyCodeLine{00546\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Write\ error\ to\ log}}
\DoxyCodeLine{00547\ \ \ \ \ \ \ \ \ \ \ \ \ Util::logError(\textcolor{stringliteral}{'Failed\ to\ start\ service:\ '}\ .\ \$this-\/>getName()\ .\ \textcolor{stringliteral}{'\ with\ error\ code:\ '}\ .\ \$start);}
\DoxyCodeLine{00548\ }
\DoxyCodeLine{00549\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \$this-\/>getName()\ ==\ BinApache::SERVICE\_NAME\ )\ \{}
\DoxyCodeLine{00550\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \$cmdOutput\ =\ \$bearsamppBins-\/>getApache()-\/>getCmdLineOutput(\ BinApache::CMD\_SYNTAX\_CHECK\ );}
\DoxyCodeLine{00551\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ !\$cmdOutput[\textcolor{stringliteral}{'syntaxOk'}]\ )\ \{}
\DoxyCodeLine{00552\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ file\_put\_contents(}
\DoxyCodeLine{00553\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \$bearsamppBins-\/>getApache()-\/>getErrorLog(),}
\DoxyCodeLine{00554\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'['}\ .\ date(\ \textcolor{stringliteral}{'Y-\/m-\/d\ H:i:s'},\ time()\ )\ .\ \textcolor{stringliteral}{']\ [error]\ '}\ .\ \$cmdOutput[\textcolor{stringliteral}{'content'}]\ .\ PHP\_EOL,}
\DoxyCodeLine{00555\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FILE\_APPEND}
\DoxyCodeLine{00556\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{00557\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00558\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00559\ \ \ \ \ \ \ \ \ \ \ \ \ elseif\ (\ \$this-\/>getName()\ ==\ BinMysql::SERVICE\_NAME\ )\ \{}
\DoxyCodeLine{00560\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \$cmdOutput\ =\ \$bearsamppBins-\/>getMysql()-\/>getCmdLineOutput(\ BinMysql::CMD\_SYNTAX\_CHECK\ );}
\DoxyCodeLine{00561\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ !\$cmdOutput[\textcolor{stringliteral}{'syntaxOk'}]\ )\ \{}
\DoxyCodeLine{00562\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ file\_put\_contents(}
\DoxyCodeLine{00563\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \$bearsamppBins-\/>getMysql()-\/>getErrorLog(),}
\DoxyCodeLine{00564\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'['}\ .\ date(\ \textcolor{stringliteral}{'Y-\/m-\/d\ H:i:s'},\ time()\ )\ .\ \textcolor{stringliteral}{']\ [error]\ '}\ .\ \$cmdOutput[\textcolor{stringliteral}{'content'}]\ .\ PHP\_EOL,}
\DoxyCodeLine{00565\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FILE\_APPEND}
\DoxyCodeLine{00566\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{00567\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00568\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00569\ \ \ \ \ \ \ \ \ \ \ \ \ elseif\ (\ \$this-\/>getName()\ ==\ BinMariadb::SERVICE\_NAME\ )\ \{}
\DoxyCodeLine{00570\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \$cmdOutput\ =\ \$bearsamppBins-\/>getMariadb()-\/>getCmdLineOutput(\ BinMariadb::CMD\_SYNTAX\_CHECK\ );}
\DoxyCodeLine{00571\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ !\$cmdOutput[\textcolor{stringliteral}{'syntaxOk'}]\ )\ \{}
\DoxyCodeLine{00572\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ file\_put\_contents(}
\DoxyCodeLine{00573\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \$bearsamppBins-\/>getMariadb()-\/>getErrorLog(),}
\DoxyCodeLine{00574\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'['}\ .\ date(\ \textcolor{stringliteral}{'Y-\/m-\/d\ H:i:s'},\ time()\ )\ .\ \textcolor{stringliteral}{']\ [error]\ '}\ .\ \$cmdOutput[\textcolor{stringliteral}{'content'}]\ .\ PHP\_EOL,}
\DoxyCodeLine{00575\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FILE\_APPEND}
\DoxyCodeLine{00576\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{00577\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00578\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00579\ }
\DoxyCodeLine{00580\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00581\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00582\ \ \ \ \ \ \ \ \ elseif\ (\ !\$this-\/>isRunning()\ )\ \{}
\DoxyCodeLine{00583\ \ \ \ \ \ \ \ \ \ \ \ \ \$this-\/>latestError\ =\ self::WIN32\_NO\_ERROR;}
\DoxyCodeLine{00584\ \ \ \ \ \ \ \ \ \ \ \ \ Util::logError(\textcolor{stringliteral}{'Service\ '}\ .\ \$this-\/>getName()\ .\ \textcolor{stringliteral}{'\ is\ not\ running\ after\ start\ attempt.'});}
\DoxyCodeLine{00585\ \ \ \ \ \ \ \ \ \ \ \ \ \$this-\/>latestError\ =\ \textcolor{keyword}{null};}
\DoxyCodeLine{00586\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00587\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00588\ }
\DoxyCodeLine{00589\ \ \ \ \ \ \ \ \ Util::logInfo(\textcolor{stringliteral}{'Service\ '}\ .\ \$this-\/>getName()\ .\ \textcolor{stringliteral}{'\ started\ successfully.'});}
\DoxyCodeLine{00590\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00591\ \ \ \ \ \}}
\DoxyCodeLine{00592\ }
\DoxyCodeLine{00598\ \ \ \ \ \textcolor{keyword}{public}\ \textcolor{keyword}{function}\ stop():\ bool}
\DoxyCodeLine{00599\ \ \ \ \ \{}
\DoxyCodeLine{00600\ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}Starting\ Win32Service::stop\ for\ service:\ "{}}\ .\ \$this-\/>getName());}
\DoxyCodeLine{00601\ }
\DoxyCodeLine{00602\ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}Calling\ win32\_stop\_service\ for\ service:\ "{}}\ .\ \$this-\/>getName());}
\DoxyCodeLine{00603\ \ \ \ \ \ \ \ \ \$result\ =\ \$this-\/>callWin32Service(\ \textcolor{stringliteral}{'win32\_stop\_service'},\ \$this-\/>getName(),\ \textcolor{keyword}{true}\ );}
\DoxyCodeLine{00604\ }
\DoxyCodeLine{00605\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Ensure\ proper\ type\ conversion\ for\ PHP\ 8.2.3\ compatibility}}
\DoxyCodeLine{00606\ \ \ \ \ \ \ \ \ \$resultInt\ =\ is\_numeric(\$result)\ ?\ (int)\$result\ :\ 0;}
\DoxyCodeLine{00607\ \ \ \ \ \ \ \ \ \$stop\ =\ \$result\ !==\ \textcolor{keyword}{null}\ ?\ dechex(\ \$resultInt\ )\ :\ \textcolor{charliteral}{'0'};}
\DoxyCodeLine{00608\ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}Stop\ service\ result\ code:\ "{}}\ .\ \$stop);}
\DoxyCodeLine{00609\ }
\DoxyCodeLine{00610\ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}Checking\ current\ status\ after\ stop\ attempt"{}});}
\DoxyCodeLine{00611\ \ \ \ \ \ \ \ \ \$currentStatus\ =\ \$this-\/>status();}
\DoxyCodeLine{00612\ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}Current\ status:\ "{}}\ .\ \$currentStatus);}
\DoxyCodeLine{00613\ }
\DoxyCodeLine{00614\ \ \ \ \ \ \ \ \ \$this-\/>writeLog(\ \textcolor{stringliteral}{'Stop\ service\ '}\ .\ \$this-\/>getName()\ .\ \textcolor{stringliteral}{':\ '}\ .\ \$stop\ .\ \textcolor{stringliteral}{'\ (status:\ '}\ .\ \$currentStatus\ .\ \textcolor{charliteral}{')'}\ );}
\DoxyCodeLine{00615\ }
\DoxyCodeLine{00616\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \$stop\ !=\ self::WIN32\_NO\_ERROR\ )\ \{}
\DoxyCodeLine{00617\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00618\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00619\ \ \ \ \ \ \ \ \ elseif\ (\ !\$this-\/>isStopped()\ )\ \{}
\DoxyCodeLine{00620\ \ \ \ \ \ \ \ \ \ \ \ \ \$this-\/>latestError\ =\ self::WIN32\_NO\_ERROR;}
\DoxyCodeLine{00621\ }
\DoxyCodeLine{00622\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00623\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00624\ }
\DoxyCodeLine{00625\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00626\ \ \ \ \ \}}
\DoxyCodeLine{00627\ }
\DoxyCodeLine{00633\ \ \ \ \ \textcolor{keyword}{public}\ \textcolor{keyword}{function}\ restart():\ bool}
\DoxyCodeLine{00634\ \ \ \ \ \{}
\DoxyCodeLine{00635\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \$this-\/>stop()\ )\ \{}
\DoxyCodeLine{00636\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \$this-\/>start();}
\DoxyCodeLine{00637\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00638\ }
\DoxyCodeLine{00639\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00640\ \ \ \ \ \}}
\DoxyCodeLine{00641\ }
\DoxyCodeLine{00647\ \ \ \ \ \textcolor{keyword}{public}\ \textcolor{keyword}{function}\ infos()}
\DoxyCodeLine{00648\ \ \ \ \ \{}
\DoxyCodeLine{00649\ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}Starting\ Win32Service::infos\ for\ service:\ "{}}\ .\ \$this-\/>getName());}
\DoxyCodeLine{00650\ }
\DoxyCodeLine{00651\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{00652\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Set\ a\ timeout\ for\ the\ entire\ operation}}
\DoxyCodeLine{00653\ \ \ \ \ \ \ \ \ \ \ \ \ \$startTime\ =\ microtime(\textcolor{keyword}{true});}
\DoxyCodeLine{00654\ \ \ \ \ \ \ \ \ \ \ \ \ \$timeout\ =\ 10;\ \textcolor{comment}{//\ 10\ seconds\ timeout\ for\ the\ entire\ operation}}
\DoxyCodeLine{00655\ }
\DoxyCodeLine{00656\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\$this-\/>getNssm()\ instanceof\ Nssm)\ \{}
\DoxyCodeLine{00657\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}Using\ NSSM\ to\ get\ service\ info"{}});}
\DoxyCodeLine{00658\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \$result\ =\ \$this-\/>getNssm()-\/>infos();}
\DoxyCodeLine{00659\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}NSSM\ info\ retrieval\ completed\ in\ "{}}\ .\ round(microtime(\textcolor{keyword}{true})\ -\/\ \$startTime,\ 2)\ .\ \textcolor{stringliteral}{"{}\ seconds"{}});}
\DoxyCodeLine{00660\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \$result;}
\DoxyCodeLine{00661\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00662\ }
\DoxyCodeLine{00663\ \ \ \ \ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}Using\ VBS\ to\ get\ service\ info"{}});}
\DoxyCodeLine{00664\ }
\DoxyCodeLine{00665\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Use\ set\_time\_limit\ to\ prevent\ PHP\ script\ timeout}}
\DoxyCodeLine{00666\ \ \ \ \ \ \ \ \ \ \ \ \ \$originalTimeout\ =\ ini\_get(\textcolor{stringliteral}{'max\_execution\_time'});}
\DoxyCodeLine{00667\ \ \ \ \ \ \ \ \ \ \ \ \ set\_time\_limit(15);\ \textcolor{comment}{//\ 15\ seconds\ timeout}}
\DoxyCodeLine{00668\ }
\DoxyCodeLine{00669\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Create\ a\ separate\ process\ to\ get\ service\ info\ with\ a\ timeout}}
\DoxyCodeLine{00670\ \ \ \ \ \ \ \ \ \ \ \ \ \$result\ =\ Vbs::getServiceInfos(\$this-\/>getName());}
\DoxyCodeLine{00671\ }
\DoxyCodeLine{00672\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Reset\ the\ timeout}}
\DoxyCodeLine{00673\ \ \ \ \ \ \ \ \ \ \ \ \ set\_time\_limit(\$originalTimeout);}
\DoxyCodeLine{00674\ }
\DoxyCodeLine{00675\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ if\ we've\ exceeded\ our\ timeout}}
\DoxyCodeLine{00676\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (microtime(\textcolor{keyword}{true})\ -\/\ \$startTime\ >\ \$timeout)\ \{}
\DoxyCodeLine{00677\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}Timeout\ exceeded\ in\ infos()\ method,\ returning\ false"{}});}
\DoxyCodeLine{00678\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00679\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00680\ }
\DoxyCodeLine{00681\ \ \ \ \ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}VBS\ info\ retrieval\ completed\ in\ "{}}\ .\ round(microtime(\textcolor{keyword}{true})\ -\/\ \$startTime,\ 2)\ .\ \textcolor{stringliteral}{"{}\ seconds"{}});}
\DoxyCodeLine{00682\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \$result;}
\DoxyCodeLine{00683\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\(\backslash\)Exception\ \$e)\ \{}
\DoxyCodeLine{00684\ \ \ \ \ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}Exception\ in\ infos()\ method:\ "{}}\ .\ \$e-\/>getMessage()\ .\ \textcolor{stringliteral}{"{},\ returning\ false"{}});}
\DoxyCodeLine{00685\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00686\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\(\backslash\)Throwable\ \$e)\ \{}
\DoxyCodeLine{00687\ \ \ \ \ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}Throwable\ in\ infos()\ method:\ "{}}\ .\ \$e-\/>getMessage()\ .\ \textcolor{stringliteral}{"{},\ returning\ false"{}});}
\DoxyCodeLine{00688\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00689\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00690\ \ \ \ \ \}}
\DoxyCodeLine{00691\ }
\DoxyCodeLine{00697\ \ \ \ \ \textcolor{keyword}{public}\ \textcolor{keyword}{function}\ isInstalled():\ bool}
\DoxyCodeLine{00698\ \ \ \ \ \{}
\DoxyCodeLine{00699\ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}Checking\ if\ service\ is\ installed:\ "{}}\ .\ \$this-\/>getName());}
\DoxyCodeLine{00700\ }
\DoxyCodeLine{00701\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{00702\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Set\ a\ timeout\ for\ the\ entire\ operation}}
\DoxyCodeLine{00703\ \ \ \ \ \ \ \ \ \ \ \ \ \$startTime\ =\ microtime(\textcolor{keyword}{true});}
\DoxyCodeLine{00704\ \ \ \ \ \ \ \ \ \ \ \ \ \$timeout\ =\ 15;\ \textcolor{comment}{//\ 15\ seconds\ timeout\ for\ the\ entire\ operation}}
\DoxyCodeLine{00705\ }
\DoxyCodeLine{00706\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Call\ status()\ with\ a\ try-\/catch\ to\ ensure\ we\ don't\ get\ stuck}}
\DoxyCodeLine{00707\ \ \ \ \ \ \ \ \ \ \ \ \ \$status\ =\ \$this-\/>status();}
\DoxyCodeLine{00708\ }
\DoxyCodeLine{00709\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ if\ we've\ exceeded\ our\ timeout}}
\DoxyCodeLine{00710\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (microtime(\textcolor{keyword}{true})\ -\/\ \$startTime\ >\ \$timeout)\ \{}
\DoxyCodeLine{00711\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}Timeout\ exceeded\ in\ isInstalled()\ method,\ assuming\ service\ is\ not\ installed"{}});}
\DoxyCodeLine{00712\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \$this-\/>writeLog(\textcolor{stringliteral}{'isInstalled\ '}\ .\ \$this-\/>getName()\ .\ \textcolor{stringliteral}{':\ NO\ (timeout\ exceeded)'});}
\DoxyCodeLine{00713\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00714\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00715\ }
\DoxyCodeLine{00716\ \ \ \ \ \ \ \ \ \ \ \ \ \$isInstalled\ =\ \$status\ !=\ self::WIN32\_SERVICE\_NA;}
\DoxyCodeLine{00717\ }
\DoxyCodeLine{00718\ \ \ \ \ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}Service\ "{}}\ .\ \$this-\/>getName()\ .\ \textcolor{stringliteral}{"{}\ installation\ status:\ "{}}\ .\ (\$isInstalled\ ?\ \textcolor{stringliteral}{"{}YES"{}}\ :\ \textcolor{stringliteral}{"{}NO"{}})\ .\ \textcolor{stringliteral}{"{}\ (status\ code:\ "{}}\ .\ \$status\ .\ \textcolor{stringliteral}{"{})"{}});}
\DoxyCodeLine{00719\ \ \ \ \ \ \ \ \ \ \ \ \ \$this-\/>writeLog(\textcolor{stringliteral}{'isInstalled\ '}\ .\ \$this-\/>getName()\ .\ \textcolor{stringliteral}{':\ '}\ .\ (\$isInstalled\ ?\ \textcolor{stringliteral}{'YES'}\ :\ \textcolor{stringliteral}{'NO'})\ .\ \textcolor{stringliteral}{'\ (status:\ '}\ .\ \$status\ .\ \textcolor{charliteral}{')'});}
\DoxyCodeLine{00720\ }
\DoxyCodeLine{00721\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \$isInstalled;}
\DoxyCodeLine{00722\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\(\backslash\)Exception\ \$e)\ \{}
\DoxyCodeLine{00723\ \ \ \ \ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}Exception\ in\ isInstalled()\ method:\ "{}}\ .\ \$e-\/>getMessage()\ .\ \textcolor{stringliteral}{"{},\ assuming\ service\ is\ not\ installed"{}});}
\DoxyCodeLine{00724\ \ \ \ \ \ \ \ \ \ \ \ \ \$this-\/>writeLog(\textcolor{stringliteral}{'isInstalled\ '}\ .\ \$this-\/>getName()\ .\ \textcolor{stringliteral}{':\ NO\ (exception:\ '}\ .\ \$e-\/>getMessage()\ .\ \textcolor{charliteral}{')'});}
\DoxyCodeLine{00725\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00726\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\(\backslash\)Throwable\ \$e)\ \{}
\DoxyCodeLine{00727\ \ \ \ \ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}Throwable\ in\ isInstalled()\ method:\ "{}}\ .\ \$e-\/>getMessage()\ .\ \textcolor{stringliteral}{"{},\ assuming\ service\ is\ not\ installed"{}});}
\DoxyCodeLine{00728\ \ \ \ \ \ \ \ \ \ \ \ \ \$this-\/>writeLog(\textcolor{stringliteral}{'isInstalled\ '}\ .\ \$this-\/>getName()\ .\ \textcolor{stringliteral}{':\ NO\ (throwable:\ '}\ .\ \$e-\/>getMessage()\ .\ \textcolor{charliteral}{')'});}
\DoxyCodeLine{00729\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00730\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00731\ \ \ \ \ \}}
\DoxyCodeLine{00732\ }
\DoxyCodeLine{00738\ \ \ \ \ \textcolor{keyword}{public}\ \textcolor{keyword}{function}\ isRunning():\ bool}
\DoxyCodeLine{00739\ \ \ \ \ \{}
\DoxyCodeLine{00740\ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}Checking\ if\ service\ is\ running:\ "{}}\ .\ \$this-\/>getName());}
\DoxyCodeLine{00741\ }
\DoxyCodeLine{00742\ \ \ \ \ \ \ \ \ \$status\ =\ \$this-\/>status();}
\DoxyCodeLine{00743\ \ \ \ \ \ \ \ \ \$isRunning\ =\ \$status\ ==\ self::WIN32\_SERVICE\_RUNNING;}
\DoxyCodeLine{00744\ }
\DoxyCodeLine{00745\ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}Service\ "{}}\ .\ \$this-\/>getName()\ .\ \textcolor{stringliteral}{"{}\ running\ status:\ "{}}\ .\ (\$isRunning\ ?\ \textcolor{stringliteral}{"{}YES"{}}\ :\ \textcolor{stringliteral}{"{}NO"{}})\ .\ \textcolor{stringliteral}{"{}\ (status\ code:\ "{}}\ .\ \$status\ .\ \textcolor{stringliteral}{"{})"{}});}
\DoxyCodeLine{00746\ \ \ \ \ \ \ \ \ \$this-\/>writeLog(\ \textcolor{stringliteral}{'isRunning\ '}\ .\ \$this-\/>getName()\ .\ \textcolor{stringliteral}{':\ '}\ .\ (\$isRunning\ ?\ \textcolor{stringliteral}{'YES'}\ :\ \textcolor{stringliteral}{'NO'})\ .\ \textcolor{stringliteral}{'\ (status:\ '}\ .\ \$status\ .\ \textcolor{charliteral}{')'}\ );}
\DoxyCodeLine{00747\ }
\DoxyCodeLine{00748\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \$isRunning;}
\DoxyCodeLine{00749\ \ \ \ \ \}}
\DoxyCodeLine{00750\ }
\DoxyCodeLine{00756\ \ \ \ \ \textcolor{keyword}{public}\ \textcolor{keyword}{function}\ isStopped():\ bool}
\DoxyCodeLine{00757\ \ \ \ \ \{}
\DoxyCodeLine{00758\ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}Checking\ if\ service\ is\ stopped:\ "{}}\ .\ \$this-\/>getName());}
\DoxyCodeLine{00759\ }
\DoxyCodeLine{00760\ \ \ \ \ \ \ \ \ \$status\ =\ \$this-\/>status();}
\DoxyCodeLine{00761\ \ \ \ \ \ \ \ \ \$isStopped\ =\ \$status\ ==\ self::WIN32\_SERVICE\_STOPPED;}
\DoxyCodeLine{00762\ }
\DoxyCodeLine{00763\ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}Service\ "{}}\ .\ \$this-\/>getName()\ .\ \textcolor{stringliteral}{"{}\ stopped\ status:\ "{}}\ .\ (\$isStopped\ ?\ \textcolor{stringliteral}{"{}YES"{}}\ :\ \textcolor{stringliteral}{"{}NO"{}})\ .\ \textcolor{stringliteral}{"{}\ (status\ code:\ "{}}\ .\ \$status\ .\ \textcolor{stringliteral}{"{})"{}});}
\DoxyCodeLine{00764\ \ \ \ \ \ \ \ \ \$this-\/>writeLog(\ \textcolor{stringliteral}{'isStopped\ '}\ .\ \$this-\/>getName()\ .\ \textcolor{stringliteral}{':\ '}\ .\ (\$isStopped\ ?\ \textcolor{stringliteral}{'YES'}\ :\ \textcolor{stringliteral}{'NO'})\ .\ \textcolor{stringliteral}{'\ (status:\ '}\ .\ \$status\ .\ \textcolor{charliteral}{')'}\ );}
\DoxyCodeLine{00765\ }
\DoxyCodeLine{00766\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \$isStopped;}
\DoxyCodeLine{00767\ \ \ \ \ \}}
\DoxyCodeLine{00768\ }
\DoxyCodeLine{00774\ \ \ \ \ \textcolor{keyword}{public}\ \textcolor{keyword}{function}\ isPaused():\ bool}
\DoxyCodeLine{00775\ \ \ \ \ \{}
\DoxyCodeLine{00776\ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}Checking\ if\ service\ is\ paused:\ "{}}\ .\ \$this-\/>getName());}
\DoxyCodeLine{00777\ }
\DoxyCodeLine{00778\ \ \ \ \ \ \ \ \ \$status\ =\ \$this-\/>status();}
\DoxyCodeLine{00779\ \ \ \ \ \ \ \ \ \$isPaused\ =\ \$status\ ==\ self::WIN32\_SERVICE\_PAUSED;}
\DoxyCodeLine{00780\ }
\DoxyCodeLine{00781\ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}Service\ "{}}\ .\ \$this-\/>getName()\ .\ \textcolor{stringliteral}{"{}\ paused\ status:\ "{}}\ .\ (\$isPaused\ ?\ \textcolor{stringliteral}{"{}YES"{}}\ :\ \textcolor{stringliteral}{"{}NO"{}})\ .\ \textcolor{stringliteral}{"{}\ (status\ code:\ "{}}\ .\ \$status\ .\ \textcolor{stringliteral}{"{})"{}});}
\DoxyCodeLine{00782\ \ \ \ \ \ \ \ \ \$this-\/>writeLog(\ \textcolor{stringliteral}{'isPaused\ '}\ .\ \$this-\/>getName()\ .\ \textcolor{stringliteral}{':\ '}\ .\ (\$isPaused\ ?\ \textcolor{stringliteral}{'YES'}\ :\ \textcolor{stringliteral}{'NO'})\ .\ \textcolor{stringliteral}{'\ (status:\ '}\ .\ \$status\ .\ \textcolor{charliteral}{')'}\ );}
\DoxyCodeLine{00783\ }
\DoxyCodeLine{00784\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \$isPaused;}
\DoxyCodeLine{00785\ \ \ \ \ \}}
\DoxyCodeLine{00786\ }
\DoxyCodeLine{00794\ \ \ \ \ \textcolor{keyword}{public}\ \textcolor{keyword}{function}\ isPending(\$status):\ bool}
\DoxyCodeLine{00795\ \ \ \ \ \{}
\DoxyCodeLine{00796\ \ \ \ \ \ \ \ \ \$isPending\ =\ \$status\ ==\ self::WIN32\_SERVICE\_START\_PENDING\ ||\ \$status\ ==\ self::WIN32\_SERVICE\_STOP\_PENDING}
\DoxyCodeLine{00797\ \ \ \ \ \ \ \ \ \ \ \ \ ||\ \$status\ ==\ self::WIN32\_SERVICE\_CONTINUE\_PENDING\ ||\ \$status\ ==\ self::WIN32\_SERVICE\_PAUSE\_PENDING;}
\DoxyCodeLine{00798\ }
\DoxyCodeLine{00799\ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}Checking\ if\ status\ is\ pending:\ "{}}\ .\ \$status\ .\ \textcolor{stringliteral}{"{}\ -\/\ Result:\ "{}}\ .\ (\$isPending\ ?\ \textcolor{stringliteral}{"{}YES"{}}\ :\ \textcolor{stringliteral}{"{}NO"{}}));}
\DoxyCodeLine{00800\ }
\DoxyCodeLine{00801\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\$isPending)\ \{}
\DoxyCodeLine{00802\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\$status\ ==\ self::WIN32\_SERVICE\_START\_PENDING)\ \{}
\DoxyCodeLine{00803\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}Service\ is\ in\ START\_PENDING\ state"{}});}
\DoxyCodeLine{00804\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\$status\ ==\ self::WIN32\_SERVICE\_STOP\_PENDING)\ \{}
\DoxyCodeLine{00805\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}Service\ is\ in\ STOP\_PENDING\ state"{}});}
\DoxyCodeLine{00806\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\$status\ ==\ self::WIN32\_SERVICE\_CONTINUE\_PENDING)\ \{}
\DoxyCodeLine{00807\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}Service\ is\ in\ CONTINUE\_PENDING\ state"{}});}
\DoxyCodeLine{00808\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\$status\ ==\ self::WIN32\_SERVICE\_PAUSE\_PENDING)\ \{}
\DoxyCodeLine{00809\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{"{}Service\ is\ in\ PAUSE\_PENDING\ state"{}});}
\DoxyCodeLine{00810\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00811\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00812\ }
\DoxyCodeLine{00813\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \$isPending;}
\DoxyCodeLine{00814\ \ \ \ \ \}}
\DoxyCodeLine{00815\ }
\DoxyCodeLine{00823\ \ \ \ \ \textcolor{keyword}{private}\ \textcolor{keyword}{function}\ getWin32ServiceStatusDesc(\$status):\ ?string}
\DoxyCodeLine{00824\ \ \ \ \ \{}
\DoxyCodeLine{00825\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{switch}\ (\ \$status\ )\ \{}
\DoxyCodeLine{00826\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ self::WIN32\_SERVICE\_CONTINUE\_PENDING:}
\DoxyCodeLine{00827\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{'The\ service\ continue\ is\ pending.'};}
\DoxyCodeLine{00828\ }
\DoxyCodeLine{00829\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ self::WIN32\_SERVICE\_PAUSE\_PENDING:}
\DoxyCodeLine{00830\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{'The\ service\ pause\ is\ pending.'};}
\DoxyCodeLine{00831\ }
\DoxyCodeLine{00832\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ self::WIN32\_SERVICE\_PAUSED:}
\DoxyCodeLine{00833\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{'The\ service\ is\ paused.'};}
\DoxyCodeLine{00834\ }
\DoxyCodeLine{00835\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ self::WIN32\_SERVICE\_RUNNING:}
\DoxyCodeLine{00836\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{'The\ service\ is\ running.'};}
\DoxyCodeLine{00837\ }
\DoxyCodeLine{00838\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ self::WIN32\_SERVICE\_START\_PENDING:}
\DoxyCodeLine{00839\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{'The\ service\ is\ starting.'};}
\DoxyCodeLine{00840\ }
\DoxyCodeLine{00841\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ self::WIN32\_SERVICE\_STOP\_PENDING:}
\DoxyCodeLine{00842\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{'The\ service\ is\ stopping.'};}
\DoxyCodeLine{00843\ }
\DoxyCodeLine{00844\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ self::WIN32\_SERVICE\_STOPPED:}
\DoxyCodeLine{00845\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{'The\ service\ is\ not\ running.'};}
\DoxyCodeLine{00846\ }
\DoxyCodeLine{00847\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ self::WIN32\_SERVICE\_NA:}
\DoxyCodeLine{00848\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{'Cannot\ retrieve\ service\ status.'};}
\DoxyCodeLine{00849\ }
\DoxyCodeLine{00850\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00851\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{null};}
\DoxyCodeLine{00852\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00853\ \ \ \ \ \}}
\DoxyCodeLine{00854\ }
\DoxyCodeLine{00862\ \ \ \ \ \textcolor{keyword}{private}\ \textcolor{keyword}{function}\ getWin32ErrorCodeDesc(\$code):\ ?string}
\DoxyCodeLine{00863\ \ \ \ \ \{}
\DoxyCodeLine{00864\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{switch}\ (\ \$code\ )\ \{}
\DoxyCodeLine{00865\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ self::WIN32\_ERROR\_ACCESS\_DENIED:}
\DoxyCodeLine{00866\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{'The\ handle\ to\ the\ SCM\ database\ does\ not\ have\ the\ appropriate\ access\ rights.'};}
\DoxyCodeLine{00867\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ ...\ other\ cases\ ...}}
\DoxyCodeLine{00868\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00869\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{null};}
\DoxyCodeLine{00870\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00871\ \ \ \ \ \}}
\DoxyCodeLine{00872\ }
\DoxyCodeLine{00878\ \ \ \ \ \textcolor{keyword}{public}\ \textcolor{keyword}{function}\ getName():\ string}
\DoxyCodeLine{00879\ \ \ \ \ \{}
\DoxyCodeLine{00880\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \$this-\/>name;}
\DoxyCodeLine{00881\ \ \ \ \ \}}
\DoxyCodeLine{00882\ }
\DoxyCodeLine{00888\ \ \ \ \ \textcolor{keyword}{public}\ \textcolor{keyword}{function}\ setName(\$name):\ void}
\DoxyCodeLine{00889\ \ \ \ \ \{}
\DoxyCodeLine{00890\ \ \ \ \ \ \ \ \ \$this-\/>name\ =\ \$name;}
\DoxyCodeLine{00891\ \ \ \ \ \}}
\DoxyCodeLine{00892\ }
\DoxyCodeLine{00898\ \ \ \ \ \textcolor{keyword}{public}\ \textcolor{keyword}{function}\ getDisplayName():\ string}
\DoxyCodeLine{00899\ \ \ \ \ \{}
\DoxyCodeLine{00900\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \$this-\/>displayName;}
\DoxyCodeLine{00901\ \ \ \ \ \}}
\DoxyCodeLine{00902\ }
\DoxyCodeLine{00908\ \ \ \ \ \textcolor{keyword}{public}\ \textcolor{keyword}{function}\ setDisplayName(\$displayName):\ void}
\DoxyCodeLine{00909\ \ \ \ \ \{}
\DoxyCodeLine{00910\ \ \ \ \ \ \ \ \ \$this-\/>displayName\ =\ \$displayName;}
\DoxyCodeLine{00911\ \ \ \ \ \}}
\DoxyCodeLine{00912\ }
\DoxyCodeLine{00918\ \ \ \ \ \textcolor{keyword}{public}\ \textcolor{keyword}{function}\ getBinPath():\ string}
\DoxyCodeLine{00919\ \ \ \ \ \{}
\DoxyCodeLine{00920\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \$this-\/>binPath;}
\DoxyCodeLine{00921\ \ \ \ \ \}}
\DoxyCodeLine{00922\ }
\DoxyCodeLine{00928\ \ \ \ \ \textcolor{keyword}{public}\ \textcolor{keyword}{function}\ setBinPath(\$binPath):\ void}
\DoxyCodeLine{00929\ \ \ \ \ \{}
\DoxyCodeLine{00930\ \ \ \ \ \ \ \ \ \$this-\/>binPath\ =\ str\_replace(\ \textcolor{charliteral}{'"{}'},\ \textcolor{stringliteral}{''},\ Util::formatWindowsPath(\ \$binPath\ )\ );}
\DoxyCodeLine{00931\ \ \ \ \ \}}
\DoxyCodeLine{00932\ }
\DoxyCodeLine{00938\ \ \ \ \ \textcolor{keyword}{public}\ \textcolor{keyword}{function}\ getParams():\ string}
\DoxyCodeLine{00939\ \ \ \ \ \{}
\DoxyCodeLine{00940\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \$this-\/>params;}
\DoxyCodeLine{00941\ \ \ \ \ \}}
\DoxyCodeLine{00942\ }
\DoxyCodeLine{00948\ \ \ \ \ \textcolor{keyword}{public}\ \textcolor{keyword}{function}\ setParams(\$params):\ void}
\DoxyCodeLine{00949\ \ \ \ \ \{}
\DoxyCodeLine{00950\ \ \ \ \ \ \ \ \ \$this-\/>params\ =\ \$params;}
\DoxyCodeLine{00951\ \ \ \ \ \}}
\DoxyCodeLine{00952\ }
\DoxyCodeLine{00958\ \ \ \ \ \textcolor{keyword}{public}\ \textcolor{keyword}{function}\ getStartType():\ string}
\DoxyCodeLine{00959\ \ \ \ \ \{}
\DoxyCodeLine{00960\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \$this-\/>startType;}
\DoxyCodeLine{00961\ \ \ \ \ \}}
\DoxyCodeLine{00962\ }
\DoxyCodeLine{00968\ \ \ \ \ \textcolor{keyword}{public}\ \textcolor{keyword}{function}\ setStartType(\$startType):\ void}
\DoxyCodeLine{00969\ \ \ \ \ \{}
\DoxyCodeLine{00970\ \ \ \ \ \ \ \ \ \$this-\/>startType\ =\ \$startType;}
\DoxyCodeLine{00971\ \ \ \ \ \}}
\DoxyCodeLine{00972\ }
\DoxyCodeLine{00978\ \ \ \ \ \textcolor{keyword}{public}\ \textcolor{keyword}{function}\ getErrorControl():\ string}
\DoxyCodeLine{00979\ \ \ \ \ \{}
\DoxyCodeLine{00980\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \$this-\/>errorControl;}
\DoxyCodeLine{00981\ \ \ \ \ \}}
\DoxyCodeLine{00982\ }
\DoxyCodeLine{00988\ \ \ \ \ \textcolor{keyword}{public}\ \textcolor{keyword}{function}\ setErrorControl(\$errorControl):\ void}
\DoxyCodeLine{00989\ \ \ \ \ \{}
\DoxyCodeLine{00990\ \ \ \ \ \ \ \ \ \$this-\/>errorControl\ =\ \$errorControl;}
\DoxyCodeLine{00991\ \ \ \ \ \}}
\DoxyCodeLine{00992\ }
\DoxyCodeLine{00998\ \ \ \ \ \textcolor{keyword}{public}\ \textcolor{keyword}{function}\ getNssm()}
\DoxyCodeLine{00999\ \ \ \ \ \{}
\DoxyCodeLine{01000\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \$this-\/>nssm;}
\DoxyCodeLine{01001\ \ \ \ \ \}}
\DoxyCodeLine{01002\ }
\DoxyCodeLine{01008\ \ \ \ \ \textcolor{keyword}{public}\ \textcolor{keyword}{function}\ setNssm(\$nssm)}
\DoxyCodeLine{01009\ \ \ \ \ \{}
\DoxyCodeLine{01010\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \$nssm\ instanceof\ Nssm\ )\ \{}
\DoxyCodeLine{01011\ \ \ \ \ \ \ \ \ \ \ \ \ \$this-\/>setDisplayName(\ \$nssm-\/>getDisplayName()\ );}
\DoxyCodeLine{01012\ \ \ \ \ \ \ \ \ \ \ \ \ \$this-\/>setBinPath(\ \$nssm-\/>getBinPath()\ );}
\DoxyCodeLine{01013\ \ \ \ \ \ \ \ \ \ \ \ \ \$this-\/>setParams(\ \$nssm-\/>getParams()\ );}
\DoxyCodeLine{01014\ \ \ \ \ \ \ \ \ \ \ \ \ \$this-\/>setStartType(\ \$nssm-\/>getStart()\ );}
\DoxyCodeLine{01015\ \ \ \ \ \ \ \ \ \ \ \ \ \$this-\/>nssm\ =\ \$nssm;}
\DoxyCodeLine{01016\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01017\ \ \ \ \ \}}
\DoxyCodeLine{01018\ }
\DoxyCodeLine{01024\ \ \ \ \ \textcolor{keyword}{public}\ \textcolor{keyword}{function}\ getLatestStatus()}
\DoxyCodeLine{01025\ \ \ \ \ \{}
\DoxyCodeLine{01026\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \$this-\/>latestStatus;}
\DoxyCodeLine{01027\ \ \ \ \ \}}
\DoxyCodeLine{01028\ }
\DoxyCodeLine{01034\ \ \ \ \ \textcolor{keyword}{public}\ \textcolor{keyword}{function}\ getLatestError()}
\DoxyCodeLine{01035\ \ \ \ \ \{}
\DoxyCodeLine{01036\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \$this-\/>latestError;}
\DoxyCodeLine{01037\ \ \ \ \ \}}
\DoxyCodeLine{01038\ }
\DoxyCodeLine{01044\ \ \ \ \ \textcolor{keyword}{public}\ \textcolor{keyword}{function}\ getError()}
\DoxyCodeLine{01045\ \ \ \ \ \{}
\DoxyCodeLine{01046\ \ \ \ \ \ \ \ \ global\ \$bearsamppLang;}
\DoxyCodeLine{01047\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \$this-\/>latestError\ !=\ self::WIN32\_NO\_ERROR\ )\ \{}
\DoxyCodeLine{01048\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Ensure\ proper\ type\ conversion\ for\ PHP\ 8.2.3\ compatibility}}
\DoxyCodeLine{01049\ \ \ \ \ \ \ \ \ \ \ \ \ \$errorInt\ =\ is\_numeric(\$this-\/>latestError)\ ?\ hexdec(\ \$this-\/>latestError\ )\ :\ 0;}
\DoxyCodeLine{01050\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \$bearsamppLang-\/>getValue(\ Lang::ERROR\ )\ .\ \textcolor{charliteral}{'\ '}\ .}
\DoxyCodeLine{01051\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \$this-\/>latestError\ .\ \textcolor{stringliteral}{'\ ('}\ .\ \$errorInt\ .\ \textcolor{stringliteral}{'\ :\ '}\ .\ \$this-\/>getWin32ErrorCodeDesc(\ \$this-\/>latestError\ )\ .\ \textcolor{charliteral}{')'};}
\DoxyCodeLine{01052\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01053\ \ \ \ \ \ \ \ \ elseif\ (\ \$this-\/>latestStatus\ !=\ self::WIN32\_SERVICE\_NA\ )\ \{}
\DoxyCodeLine{01054\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Ensure\ proper\ type\ conversion\ for\ PHP\ 8.2.3\ compatibility}}
\DoxyCodeLine{01055\ \ \ \ \ \ \ \ \ \ \ \ \ \$statusInt\ =\ is\_numeric(\$this-\/>latestStatus)\ ?\ hexdec(\ \$this-\/>latestStatus\ )\ :\ 0;}
\DoxyCodeLine{01056\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \$bearsamppLang-\/>getValue(\ Lang::STATUS\ )\ .\ \textcolor{charliteral}{'\ '}\ .}
\DoxyCodeLine{01057\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \$this-\/>latestStatus\ .\ \textcolor{stringliteral}{'\ ('}\ .\ \$statusInt\ .\ \textcolor{stringliteral}{'\ :\ '}\ .\ \$this-\/>getWin32ServiceStatusDesc(\ \$this-\/>latestStatus\ )\ .\ \textcolor{charliteral}{')'};}
\DoxyCodeLine{01058\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01059\ }
\DoxyCodeLine{01060\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{null};}
\DoxyCodeLine{01061\ \ \ \ \ \}}
\DoxyCodeLine{01062\ \}}

\end{DoxyCode}

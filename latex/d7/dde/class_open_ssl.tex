\doxysection{Open\+Ssl Class Reference}
\label{class_open_ssl}\index{OpenSsl@{OpenSsl}}
\doxysubsubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\textbf{ create\+Crt} (\$name, \$dest\+Path=null)
\item 
\textbf{ exists\+Crt} (\$name)
\item 
\textbf{ remove\+Crt} (\$name)
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}


Definition at line \textbf{ 11} of file \textbf{ class.\+openssl.\+php}.



\label{doc-func-members}
\doxysubsection{Member Function Documentation}
\index{OpenSsl@{OpenSsl}!createCrt@{createCrt}}
\index{createCrt@{createCrt}!OpenSsl@{OpenSsl}}
\doxysubsubsection{createCrt()}
{\footnotesize\ttfamily \label{class_open_ssl_a55abe545574ebe853ae39930a2d84d9e} 
create\+Crt (\begin{DoxyParamCaption}\item[{}]{\$name}{, }\item[{}]{\$dest\+Path}{ = {\ttfamily null}}\end{DoxyParamCaption})}

Creates a certificate with the specified name and destination path.


\begin{DoxyParams}[1]{Parameters}
string & {\em \$name} & The name of the certificate. \\
\hline
string | null & {\em \$dest\+Path} & The destination path where the certificate files will be saved. If null, the default SSL path is used. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
bool True if the certificate was created successfully, false otherwise. 
\end{DoxyReturn}


Definition at line \textbf{ 20} of file \textbf{ class.\+openssl.\+php}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00021\ \ \ \ \ \{}
\DoxyCodeLine{00022\ \ \ \ \ \ \ \ \ global\ \$bearsamppRoot,\ \$bearsamppCore;}
\DoxyCodeLine{00023\ \ \ \ \ \ \ \ \ \$destPath\ =\ empty(\$destPath)\ ?\ \$bearsamppRoot-\/>getSslPath()\ :\ \$destPath;}
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00025\ \ \ \ \ \ \ \ \ \$subject\ =\ \textcolor{stringliteral}{'"{}/C=US/O=Bearsampp/CN='}\ .\ \$name\ .\ \textcolor{charliteral}{'"{}'};}
\DoxyCodeLine{00026\ \ \ \ \ \ \ \ \ \$password\ =\ \textcolor{stringliteral}{'pass:bearsampp'};}
\DoxyCodeLine{00027\ \ \ \ \ \ \ \ \ \$ppkPath\ =\ \textcolor{charliteral}{'"{}'}\ .\ \$destPath\ .\ \textcolor{charliteral}{'/'}\ .\ \$name\ .\ \textcolor{stringliteral}{'.ppk"{}'};}
\DoxyCodeLine{00028\ \ \ \ \ \ \ \ \ \$pubPath\ =\ \textcolor{charliteral}{'"{}'}\ .\ \$destPath\ .\ \textcolor{charliteral}{'/'}\ .\ \$name\ .\ \textcolor{stringliteral}{'.pub"{}'};}
\DoxyCodeLine{00029\ \ \ \ \ \ \ \ \ \$crtPath\ =\ \textcolor{charliteral}{'"{}'}\ .\ \$destPath\ .\ \textcolor{charliteral}{'/'}\ .\ \$name\ .\ \textcolor{stringliteral}{'.crt"{}'};}
\DoxyCodeLine{00030\ \ \ \ \ \ \ \ \ \$extension\ =\ \textcolor{stringliteral}{'SAN'};}
\DoxyCodeLine{00031\ \ \ \ \ \ \ \ \ \$exe\ =\ \textcolor{charliteral}{'"{}'}\ .\ \$bearsamppCore-\/>getOpenSslExe()\ .\ \textcolor{charliteral}{'"{}'};}
\DoxyCodeLine{00032\ }
\DoxyCodeLine{00033\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ ext}}
\DoxyCodeLine{00034\ \ \ \ \ \ \ \ \ \$extContent\ =\ PHP\_EOL\ .\ \textcolor{charliteral}{'['}\ .\ \$extension\ .\ \textcolor{charliteral}{']'}\ .\ PHP\_EOL;}
\DoxyCodeLine{00035\ \ \ \ \ \ \ \ \ \$extContent\ .=\ \textcolor{stringliteral}{'subjectAltName=DNS:*.'}\ .\ \$name\ .\ \textcolor{stringliteral}{',DNS:'}\ .\ \$name\ .\ PHP\_EOL;}
\DoxyCodeLine{00036\ }
\DoxyCodeLine{00037\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ tmp\ openssl.cfg}}
\DoxyCodeLine{00038\ \ \ \ \ \ \ \ \ \$conf\ =\ \$bearsamppCore-\/>getTmpPath()\ .\ \textcolor{stringliteral}{'/openssl\_'}\ .\ \$name\ .\ \textcolor{charliteral}{'\_'}\ .\ Util::random()\ .\ \textcolor{stringliteral}{'.cfg'};}
\DoxyCodeLine{00039\ \ \ \ \ \ \ \ \ file\_put\_contents(\$conf,\ file\_get\_contents(\$bearsamppCore-\/>getOpenSslConf())\ .\ \$extContent);}
\DoxyCodeLine{00040\ }
\DoxyCodeLine{00041\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Properly\ quote\ the\ config\ path\ for\ batch\ commands}}
\DoxyCodeLine{00042\ \ \ \ \ \ \ \ \ \$confPath\ =\ \textcolor{charliteral}{'"{}'}\ .\ \$conf\ .\ \textcolor{charliteral}{'"{}'};}
\DoxyCodeLine{00043\ }
\DoxyCodeLine{00044\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ ppk\ -\/\ Updated\ for\ OpenSSL\ 3.x\ syntax}}
\DoxyCodeLine{00045\ \ \ \ \ \ \ \ \ \$batch\ =\ \$exe\ .\ \textcolor{stringliteral}{'\ genpkey\ -\/algorithm\ RSA\ -\/pkeyopt\ rsa\_keygen\_bits:2048\ -\/aes256\ -\/pass\ '}\ .\ \$password\ .\ \textcolor{stringliteral}{'\ -\/out\ '}\ .\ \$ppkPath\ .\ \textcolor{stringliteral}{'\ -\/config\ '}\ .\ \$confPath\ .\ PHP\_EOL;}
\DoxyCodeLine{00046\ \ \ \ \ \ \ \ \ \$batch\ .=\ \textcolor{stringliteral}{'IF\ \%ERRORLEVEL\%\ GEQ\ 1\ GOTO\ EOF'}\ .\ PHP\_EOL\ .\ PHP\_EOL;}
\DoxyCodeLine{00047\ }
\DoxyCodeLine{00048\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ pub}}
\DoxyCodeLine{00049\ \ \ \ \ \ \ \ \ \$batch\ .=\ \$exe\ .\ \textcolor{stringliteral}{'\ rsa\ -\/in\ '}\ .\ \$ppkPath\ .\ \textcolor{stringliteral}{'\ -\/passin\ '}\ .\ \$password\ .\ \textcolor{stringliteral}{'\ -\/out\ '}\ .\ \$pubPath\ .\ PHP\_EOL\ .\ PHP\_EOL;}
\DoxyCodeLine{00050\ \ \ \ \ \ \ \ \ \$batch\ .=\ \textcolor{stringliteral}{'IF\ \%ERRORLEVEL\%\ GEQ\ 1\ GOTO\ EOF'}\ .\ PHP\_EOL\ .\ PHP\_EOL;}
\DoxyCodeLine{00051\ }
\DoxyCodeLine{00052\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ crt}}
\DoxyCodeLine{00053\ \ \ \ \ \ \ \ \ \$batch\ .=\ \$exe\ .\ \textcolor{stringliteral}{'\ req\ -\/x509\ -\/nodes\ -\/sha256\ -\/new\ -\/key\ '}\ .\ \$pubPath\ .\ \textcolor{stringliteral}{'\ -\/out\ '}\ .\ \$crtPath\ .\ \textcolor{stringliteral}{'\ -\/passin\ '}\ .\ \$password;}
\DoxyCodeLine{00054\ \ \ \ \ \ \ \ \ \$batch\ .=\ \textcolor{stringliteral}{'\ -\/subj\ '}\ .\ \$subject\ .\ \textcolor{stringliteral}{'\ -\/reqexts\ '}\ .\ \$extension\ .\ \textcolor{stringliteral}{'\ -\/extensions\ '}\ .\ \$extension\ .\ \textcolor{stringliteral}{'\ -\/config\ '}\ .\ \$confPath\ .\ PHP\_EOL;}
\DoxyCodeLine{00055\ \ \ \ \ \ \ \ \ \$batch\ .=\ \textcolor{stringliteral}{'IF\ \%ERRORLEVEL\%\ GEQ\ 1\ GOTO\ EOF'}\ .\ PHP\_EOL\ .\ PHP\_EOL;}
\DoxyCodeLine{00056\ }
\DoxyCodeLine{00057\ \ \ \ \ \ \ \ \ \$batch\ .=\ \textcolor{stringliteral}{':EOF'}\ .\ PHP\_EOL;}
\DoxyCodeLine{00058\ \ \ \ \ \ \ \ \ \$batch\ .=\ \textcolor{stringliteral}{'SET\ RESULT=KO'}\ .\ PHP\_EOL;}
\DoxyCodeLine{00059\ \ \ \ \ \ \ \ \ \$batch\ .=\ \textcolor{stringliteral}{'IF\ EXIST\ '}\ .\ \$pubPath\ .\ \textcolor{stringliteral}{'\ IF\ EXIST\ '}\ .\ \$crtPath\ .\ \textcolor{stringliteral}{'\ SET\ RESULT=OK'}\ .\ PHP\_EOL;}
\DoxyCodeLine{00060\ \ \ \ \ \ \ \ \ \$batch\ .=\ \textcolor{stringliteral}{'ECHO\ \%RESULT\%'};}
\DoxyCodeLine{00061\ }
\DoxyCodeLine{00062\ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{'Creating\ SSL\ Certificate\ for\ "{}'}\ .\ \$name\ .\ \textcolor{charliteral}{'"{}'});}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ \$result\ =\ Batch::exec(\textcolor{stringliteral}{'createCertificate'},\ \$batch);}
\DoxyCodeLine{00064\ }
\DoxyCodeLine{00065\ \ \ \ \ \ \ \ \ \$success\ =\ isset(\$result[0])\ \&\&\ \$result[0]\ ==\ \textcolor{stringliteral}{'OK'};}
\DoxyCodeLine{00066\ \ \ \ \ \ \ \ \ Util::logTrace(\textcolor{stringliteral}{'SSL\ Certificate\ generation\ for\ "{}'}\ .\ \$name\ .\ \textcolor{stringliteral}{'"{}:\ '}\ .\ (\$success\ ?\ \textcolor{stringliteral}{'SUCCESS'}\ :\ \textcolor{stringliteral}{'FAILURE'}));}
\DoxyCodeLine{00067\ }
\DoxyCodeLine{00068\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \$success;}
\DoxyCodeLine{00069\ \ \ \ \ \}}

\end{DoxyCode}


References \textbf{ \$bearsampp\+Core}, \textbf{ \$bearsampp\+Root}, \textbf{ \$result}, \textbf{ Batch\textbackslash{}exec()}, \textbf{ Util\textbackslash{}log\+Trace()}, and \textbf{ Util\textbackslash{}random()}.

\index{OpenSsl@{OpenSsl}!existsCrt@{existsCrt}}
\index{existsCrt@{existsCrt}!OpenSsl@{OpenSsl}}
\doxysubsubsection{existsCrt()}
{\footnotesize\ttfamily \label{class_open_ssl_a6095afca36d492519916c08b3d317f83} 
exists\+Crt (\begin{DoxyParamCaption}\item[{}]{\$name}{}\end{DoxyParamCaption})}

Checks if a certificate with the specified name exists.


\begin{DoxyParams}[1]{Parameters}
string & {\em \$name} & The name of the certificate. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
bool True if the certificate exists, false otherwise. 
\end{DoxyReturn}


Definition at line \textbf{ 77} of file \textbf{ class.\+openssl.\+php}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00078\ \ \ \ \ \{}
\DoxyCodeLine{00079\ \ \ \ \ \ \ \ \ global\ \$bearsamppRoot;}
\DoxyCodeLine{00080\ }
\DoxyCodeLine{00081\ \ \ \ \ \ \ \ \ \$ppkPath\ =\ \$bearsamppRoot-\/>getSslPath()\ .\ \textcolor{charliteral}{'/'}\ .\ \$name\ .\ \textcolor{stringliteral}{'.ppk'};}
\DoxyCodeLine{00082\ \ \ \ \ \ \ \ \ \$pubPath\ =\ \$bearsamppRoot-\/>getSslPath()\ .\ \textcolor{charliteral}{'/'}\ .\ \$name\ .\ \textcolor{stringliteral}{'.pub'};}
\DoxyCodeLine{00083\ \ \ \ \ \ \ \ \ \$crtPath\ =\ \$bearsamppRoot-\/>getSslPath()\ .\ \textcolor{charliteral}{'/'}\ .\ \$name\ .\ \textcolor{stringliteral}{'.crt'};}
\DoxyCodeLine{00084\ }
\DoxyCodeLine{00085\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ is\_file(\$ppkPath)\ \&\&\ is\_file(\$pubPath)\ \&\&\ is\_file(\$crtPath);}
\DoxyCodeLine{00086\ \ \ \ \ \}}

\end{DoxyCode}


References \textbf{ \$bearsampp\+Root}.

\index{OpenSsl@{OpenSsl}!removeCrt@{removeCrt}}
\index{removeCrt@{removeCrt}!OpenSsl@{OpenSsl}}
\doxysubsubsection{removeCrt()}
{\footnotesize\ttfamily \label{class_open_ssl_a8e534088721151013782352d4f356331} 
remove\+Crt (\begin{DoxyParamCaption}\item[{}]{\$name}{}\end{DoxyParamCaption})}

Removes a certificate with the specified name.


\begin{DoxyParams}[1]{Parameters}
string & {\em \$name} & The name of the certificate. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
bool True if the certificate was removed successfully, false otherwise. 
\end{DoxyReturn}


Definition at line \textbf{ 94} of file \textbf{ class.\+openssl.\+php}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00095\ \ \ \ \ \{}
\DoxyCodeLine{00096\ \ \ \ \ \ \ \ \ global\ \$bearsamppRoot;}
\DoxyCodeLine{00097\ }
\DoxyCodeLine{00098\ \ \ \ \ \ \ \ \ \$ppkPath\ =\ \$bearsamppRoot-\/>getSslPath()\ .\ \textcolor{charliteral}{'/'}\ .\ \$name\ .\ \textcolor{stringliteral}{'.ppk'};}
\DoxyCodeLine{00099\ \ \ \ \ \ \ \ \ \$pubPath\ =\ \$bearsamppRoot-\/>getSslPath()\ .\ \textcolor{charliteral}{'/'}\ .\ \$name\ .\ \textcolor{stringliteral}{'.pub'};}
\DoxyCodeLine{00100\ \ \ \ \ \ \ \ \ \$crtPath\ =\ \$bearsamppRoot-\/>getSslPath()\ .\ \textcolor{charliteral}{'/'}\ .\ \$name\ .\ \textcolor{stringliteral}{'.crt'};}
\DoxyCodeLine{00101\ }
\DoxyCodeLine{00102\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ @unlink(\$ppkPath)\ \&\&\ @unlink(\$pubPath)\ \&\&\ @unlink(\$crtPath);}
\DoxyCodeLine{00103\ \ \ \ \ \}}

\end{DoxyCode}


References \textbf{ \$bearsampp\+Root}.



The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
E\+:/\+Bearsampp-\/development/sandbox/core/classes/\textbf{ class.\+openssl.\+php}\end{DoxyCompactItemize}
